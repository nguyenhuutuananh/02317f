function survey_toggle_full_view(){$("#survey-add-edit-wrapper").toggleClass("hide"),$("#survey_questions_wrapper").toggleClass("col-md-12"),$("#survey_questions_wrapper").toggleClass("col-md-7")}function add_survey_question(a,b){$.post(admin_url+"surveys/add_survey_question",{type:a,surveyid:b}).done(function(b){b=JSON.parse(b),question_area="<li>",question_area+='<div class="form-group question">',question_area+='<div class="checkbox checkbox-primary required">',question_area+='<input type="checkbox" data-question_required="'+b.data.questionid+'" name="required[]" onchange="update_question(this,\''+a+"',"+b.data.questionid+')">',question_area+="<label>"+b.survey_question_required+"</label>",question_area+="</div>",question_area+=hidden_input("order[]",""),question_area+='<label for="'+b.data.questionid+'" class="control-label display-block">'+b.survey_question_string+' <a href="#" onclick="update_question(this,\''+a+"',"+b.data.questionid+'); return false;" class="pull-right update-question-button"><i class="fa fa-refresh text-success question_update"></i></a><a href="#" class="pull-right"><i class="fa fa-remove text-danger" onclick="remove_question_from_database(this,'+b.data.questionid+'); return false;"></i></a></label>',question_area+='<input type="text" onblur="update_question(this,\''+a+"',"+b.data.questionid+');" data-questionid="'+b.data.questionid+'" class="form-control questionid">',"textarea"==a?question_area+='<textarea class="form-control mtop20" disabled="disabled" rows="6">'+b.survey_question_only_for_preview+"</textarea>":"checkbox"==a||"radio"==a?(question_area+='<div class="row">',box_description_icon_class="fa-plus",box_description_function="add_box_description_to_database(this,"+b.data.questionid+","+b.data.boxid+"); return false;",question_area+='<div class="box_area">',question_area+='<div class="col-md-12">',question_area+='<a href="#" class="add_remove_action survey_add_more_box" onclick="'+box_description_function+'"><i class="fa '+box_description_icon_class+'"></i></a>',question_area+='<div class="'+a+" "+a+'-primary">',question_area+='<input type="'+a+'" disabled="disabled"/>',question_area+="<label><input onblur=\"update_question(this,'"+a+"',"+b.data.questionid+');" type="text" data-box-descriptionid="'+b.data[0].questionboxdescriptionid+'" class="survey_input_box_description"></label>',question_area+="</div>",question_area+="</div>",question_area+="</div>",question_area+="</div>"):question_area+='<input type="text" onchange="update_question(this,\''+a+"',"+b.data.questionid+');" class="form-control mtop20" disabled="disabled" value="'+b.survey_question_only_for_preview+'">',question_area+="</div>",question_area+="</li>",$("#survey_questions").append(question_area),$("#survey_questions").sortable("refresh"),$("html,body").animate({scrollTop:$("#survey_questions li:last-child").offset().top},"slow"),update_questions_order()})}function update_question(a,b,c){$(a).parents("li").find("i.question_update").addClass("spinning");var d={},e=$(a).parents(".question").find('input[data-questionid="'+c+'"]').val(),f=$(a).parents(".question").find('input[data-question_required="'+c+'"]').prop("checked");if(d.question={value:e,required:f},d.questionid=c,"checkbox"==b||"radio"==b){var g=[],h=$(a).parents(".question").find(".box_area");$.each(h,function(){var a=$(this).find("input.survey_input_box_description").data("box-descriptionid"),b=$(this).find("input.survey_input_box_description").val(),c=[a,b];g.push(c)}),d.boxes_description=g}setTimeout(function(){$.post(admin_url+"surveys/update_question",d).done(function(b){$(a).parents("li").find("i.question_update").removeClass("spinning")})},10)}function add_more_boxes(a,b){var c=$(a).parents(".box_area").clone();$(a).parents(".question").find(".box_area").last().after(c),$(c).find("i").removeClass("fa-plus").addClass("fa-minus").addClass("text-danger"),$(c).find("input.survey_input_box_description").val(""),$(c).find("input.survey_input_box_description").attr("data-box-descriptionid",b),$(c).find("input.survey_input_box_description").focus(),$(c).find(".add_remove_action").attr("onclick","remove_box_description_from_database(this,"+b+"); return false;"),update_questions_order()}function remove_question_from_database(a,b){$.get(admin_url+"surveys/remove_question/"+b,function(b){0==b.success?alert_float("danger",b.message):($(a).parents(".question").remove(),update_questions_order())},"json")}function remove_box_description_from_database(a,b){$.get(admin_url+"surveys/remove_box_description/"+b,function(b){1==b.success?$(a).parents(".box_area").remove():alert_float("danger",b.message)},"json")}function add_box_description_to_database(a,b,c){$.get(admin_url+"surveys/add_box_description/"+b+"/"+c,function(b){b.boxdescriptionid!==!1?add_more_boxes(a,b.boxdescriptionid):alert_float("danger",b.message)},"json")}function update_questions_order(){var a=$("#survey_questions").find(".question"),b=1;$.each(a,function(){$(this).find('input[name="order[]"]').val(b),b++});var c=[];$.each(a,function(){var a=$(this).find("input.questionid").data("questionid"),b=$(this).find('input[name="order[]"]').val();c.push([a,b])}),data={},data.data=c,$.post(admin_url+"surveys/update_survey_questions_orders",data)}$(function(){$('input[name="send_survey_to[leads]"]').on("change",function(){$(".leads-statuses").slideToggle()}),$('input[name="send_survey_to[clients]"]').on("change",function(){$(".customer-groups").slideToggle()}),$(".survey-customer-groups input").on("change",function(){$(".survey-customer-groups input:checked").length>0&&$("#ml_customers_all").prop("checked",!1)}),$("#ml_customers_all").on("change",function(){$(this).prop("checked")!==!1&&$(".survey-customer-groups input").prop("checked",!1)}),_validate_form($("#survey_form"),{subject:"required"});$("#survey_questions").sortable({placeholder:"ui-state-highlight-survey",update:function(){update_questions_order()}});$(".add_email_list_custom_field_to_survey").on("click",function(a){a.preventDefault(),tinymce.get("description").execCommand("mceInsertContent",!1,$(this).data("slug"))})});