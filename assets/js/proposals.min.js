function init_proposal_editor(){tinymce.remove("div.editable");var a=[];$.each(proposal_templates,function(b,c){a.push({url:admin_url+"proposals/get_template?name="+c,title:c})});var b={selector:"div.editable",inline:!0,theme:"modern",skin:"perfex",relative_urls:!1,remove_script_host:!1,inline_styles:!0,verify_html:!1,cleanup:!1,valid_elements:"+*[*]",valid_children:"+body[style], +style[type]",apply_source_formatting:!1,file_browser_callback:elFinderBrowser,table_class_list:[{title:"Flat",value:"table"},{title:"Table Bordered",value:"table table-bordered"},{title:"Items Table",value:"proposal-items table"}],table_default_styles:{width:"100%"},setup:function(a){a.on("init",function(){this.getDoc().body.style.fontSize="14px"})},removed_menuitems:"newdocument",fontsize_formats:"8pt 10pt 12pt 14pt 18pt 24pt 36pt",plugins:["advlist pagebreak autolink autoresize lists link image charmap hr anchor","searchreplace wordcount visualblocks visualchars code fullscreen","media nonbreaking save table contextmenu directionality","paste textcolor colorpicker textpattern"],autoresize_bottom_margin:50,pagebreak_separator:'<p pagebreak="true"></p>',toolbar1:"save_button fontselect fontsizeselect insertfile | styleselect",toolbar2:"bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent",toolbar3:"media image | forecolor backcolor link ",setup:function(a){a.addButton("save_button",{text:proposal_save,icon:!1,id:"inline-editor-save-btn",onclick:function(){var b={};b.proposal_id=proposal_id,b.content=a.getContent(),$.post(admin_url+"proposals/save_proposal_data",b).done(function(a){a=JSON.parse(a),1==a.success&&alert_float("success",a.message)}).fail(function(a){var b=JSON.parse(a.responseText);alert_float("danger",b.message)})}})}};a.length>0&&(b.templates=a,b.plugins[3]="template "+b.plugins[3]);tinymce.init(b)}function add_proposal_comment(){var a=$("#comment").val();if(""!=a){var b={};b.content=a,b.proposalid=proposal_id,$("body").append('<div class="dt-loader"></div>'),$.post(admin_url+"proposals/add_proposal_comment",b).done(function(a){a=JSON.parse(a),$("body").find(".dt-loader").remove(),1==a.success&&($("#comment").val(""),get_proposal_comments())})}}function get_proposal_comments(){"undefined"!=typeof proposal_id&&$.get(admin_url+"proposals/get_proposal_comments/"+proposal_id,function(a){$("body").find("#proposal-comments").html(a)})}function remove_proposal_comment(a){var b=confirm(confirm_action_prompt);return 0!=b&&void $.get(admin_url+"proposals/remove_comment/"+a,function(b){1==b.success&&$('[data-commentid="'+a+'"]').remove()},"json")}function edit_proposal_comment(a){var b=$("body").find('[data-proposal-comment-edit-textarea="'+a+'"] textarea').val();""!=b&&($.post(admin_url+"proposals/edit_comment/"+a,{content:b}).done(function(c){c=JSON.parse(c),1==c.success&&(alert_float("success",c.message),$("body").find('[data-proposal-comment="'+a+'"]').html(nl2br(b)))}),toggle_proposal_comment_edit(a))}function toggle_proposal_comment_edit(a){$("body").find('[data-proposal-comment="'+a+'"]').toggleClass("hide"),$("body").find('[data-proposal-comment-edit-textarea="'+a+'"]').toggleClass("hide")}function convert_template(a){var b,c=$(a).data("template");if("estimate"==c)b="estimate";else{if("invoice"!=c)return!1;b="invoice"}$.get(admin_url+"proposals/get_"+b+"_convert_data/"+proposal_id).done(function(a){$("#convert_helper").html(a),$("#convert_to_"+b).modal({show:!0,backdrop:"static"}),reorder_items()})}$(function(){get_proposal_comments(),$("body").on("click",".dismiss-proposal-convert-modal",function(a){a.preventDefault(),$("body").find(".proposal-convert-modal").modal("hide")})});