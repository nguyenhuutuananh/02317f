function merge_field_format_url(a,b,c,d){return a.indexOf("{")>-1&&a.indexOf("}")>-1&&(a="{"+a.split("{")[1]),a}function slugify(a){return a.toString().trim().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function include_chart_js(){"undefined"==typeof Chart&&$.getScript(site_url+"assets/plugins/Chart.js/Chart.min.js")}function include_lightbox(){"undefined"==typeof lightbox&&($("head").append('<link id="lightbox-css" href="'+site_url+'assets/plugins/lightbox/css/lightbox.min.css" rel="stylesheet" />'),$.getScript(site_url+"assets/plugins/lightbox/js/lightbox.min.js"))}function init_lightbox(a){if("undefined"!=typeof lightbox){var b={showImageNumberLabel:!1,resizeDuration:200};"undefined"!=typeof a&&jQuery.extend(b,a),lightbox.option(b)}}function init_progress_bars(){var a=$(".progress .progress-bar");a.each(function(){var a=$(this),b=a.attr("data-percent");a.css("width",b+"%"),a.hasClass("no-percent-text")||a.text(b+"%")})}function get_url_param(a){var b={};return window.location.href.replace(location.hash,"").replace(/[?&]+([^=&]+)=?([^&]*)?/gi,function(a,c,d){b[c]=void 0!==d?d:""}),a?b[a]?b[a]:null:b}function mainWrapperHeightFix(){var a=63,b=side_bar.height(),c=$(".content").height(),d=$(document).outerHeight(!0)-a+"px";setup_menu.css("min-height",d),content_wrapper.css("min-height",$(document).outerHeight(!0)-a+"px"),c<b&&content_wrapper.css("min-height",b+"px"),c<b&&b<$(window).height()&&content_wrapper.css("min-height",$(window).height()-a+"px"),c>b&&c<$(window).height()&&content_wrapper.css("min-height",$(window).height()-a+"px")}function setBodySmall(){$(this).width()<769?$("body").addClass("page-small"):($("body").removeClass("page-small"),$("body").removeClass("show-sidebar"))}function generatePassword(a){for(var b=12,c="abcdefghijklnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",d="",e=0,f=c.length;e<b;++e)d+=c.charAt(Math.floor(Math.random()*f));$(a).parents().find("input.password").val(d)}function switch_field(a){var b,c,d;b=0,1==$(a).prop("checked")&&(b=1),c=$(a).data("switch-url"),d=$(a).data("id"),$.get(c+"/"+d+"/"+b)}function _validate_form(a,b,c){var d=($(a).validate({rules:b,messages:{email:{remote:email_exists}},ignore:[],submitHandler:function(a){return"undefined"==typeof c||void c(a)}}),$(a).find("[data-custom-field-required]"));return d.length>0&&$.each(d,function(){$(this).rules("add",{required:!0});var a=$(this).attr("name"),b=$(this).parents(".form-group").find('[for="'+a+'"]');b.length>0&&0==b.find(".req").length&&b.prepend(' <small class="req text-danger">* </small>')}),$.each(b,function(b,c){if("required"==c&&!jQuery.isPlainObject(c)||jQuery.isPlainObject(c)&&c.hasOwnProperty("required")){var d=$(a).find('[for="'+b+'"]');d.length>0&&0==d.find(".req").length&&d.prepend(' <small class="req text-danger">* </small>')}}),!1}function delete_option(a,b){var c=confirm(confirm_action_prompt);return 0!=c&&void $.get(admin_url+"settings/delete_option/"+b,function(b){1==b.success&&$(a).parents(".option").remove()},"json")}function slideToggle(a,b){$(a).hasClass("hide")&&$(a).removeClass("hide","slow"),$(a).slideToggle();var c=$(".progress-bar").not(".not-dynamic");c.length>0&&(c.each(function(){$(this).css("width","0%"),$(this).text("0%")}),init_progress_bars()),"function"==typeof b&&b()}function alert_float(a,b){var c,d;c=$("body").find("float-alert").length,c++,c="alert_float_"+c,d=$('<div id="'+c+'" class="float-alert animated fadeInRight col-xs-11 col-sm-4 alert alert-'+a+'"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><span class="fa fa-bell-o" data-notify="icon"></span><span class="alert-title">'+b+"</span></div>"),$("body").append(d),setTimeout(function(){$("#"+c).hide("fast",function(){$("#"+c).remove()})},4500)}function init_rel_tasks_table(a,b,c){if("undefined"==typeof c&&(c=".table-rel-tasks"),0!=$("body").find(c).length){var d,e,f={};e=$("._hidden_inputs._filters._tasks_filters input"),$.each(e,function(){f[$(this).attr("name")]='[name="'+$(this).attr("name")+'"]'}),d=$("body").find(c).find("th").length-1,initDataTable(c,admin_url+"tasks/init_relation_tasks/"+a+"/"+b,[d],[d],f,[2,"ASC"])}}function get_dt_export_buttons(a){var b=[{extend:"collection",text:dt_button_export,className:"btn btn-default-dt-options",buttons:[{extend:"excelHtml5",text:dt_button_excel,footer:!0,exportOptions:{columns:[":visible:not(.not-export)"]}},{extend:"csvHtml5",text:dt_button_csv,footer:!0,exportOptions:{columns:[":visible:not(.not-export)"]}},{extend:"pdfHtml5",text:dt_button_pdf,footer:!0,orientation:"landscape",customize:function(b){var c=$(a).DataTable(),d=c.columns().visible(),e=d.length,f=[],g=0;for(i=0;i<e;i++)1==d[i]&&g++;setTimeout(function(){if(g<=5){for(i=0;i<g;i++)f.push(735/g);b.content[1].table.widths=f}},10),b.styles.tableHeader.alignment="left",b.styles.tableHeader.margin=[5,5,5,5],b.pageMargins=[12,12,12,12]},exportOptions:{columns:[":visible:not(.not-export)"]}},{extend:"print",text:dt_button_print,footer:!0,exportOptions:{columns:[":visible:not(.not-export)"]}}]},{extend:"colvis",postfixButtons:["colvisRestore"],className:"btn btn-default-dt-options dt-column-visibility",text:dt_button_column_visibility},{text:dt_button_reload,className:"btn btn-default-dt-options",action:function(a,b,c,d){b.ajax.reload()}}];return 0==show_table_columns_visibility&&delete b[1],b}function initDataTableOffline(a){var b=".dt-table";"undefined"!=typeof a&&(b=a);var c,d,e,f,g={language:dt_lang,processing:!0,paginate:!0,responsive:!0,autoWidth:!1,order:[0,"DESC"],initComplete:function(a,c){var d=$(b),e=d.find("thead th:last-child"),f=d.find("thead th:first-child");e.text().trim()==options_string_translate&&e.addClass("not-export"),f.find('input[type="checkbox"]').length>0&&f.addClass("not-export")},dom:"<'mbot25'B><'row'><'row'<'col-md-6'l><'col-md-6'f>r>t<'row'<'col-md-4'i>><'row'<'#colvis'>p>"},c=$($(this)).attr("data-order-col"),d=$($(this)).attr("data-order-type"),h=$(b);$.each(h,function(){e=g,c=$(this).attr("data-order-col"),d=$(this).attr("data-order-type"),c&&d&&(e.order=[[c,d]]),f=get_dt_export_buttons(this),delete f[2],e.buttons=f,$(this).dataTable(e)})}function initDataTable(a,b,c,d,e,f){var g=a;if(0!=$(a).length){"undefined"!=e&&"undefined"!=typeof e||(e=[]),"undefined"==typeof f?f=[[0,"ASC"]]:1==f.length&&(f=[f]);var h=[10,25,50,100],i=[10,25,50,100];tables_pagination_limit=parseFloat(tables_pagination_limit),$.inArray(tables_pagination_limit,h)==-1&&(h.push(tables_pagination_limit),i.push(tables_pagination_limit)),h.sort(function(a,b){return a-b}),i.sort(function(a,b){return a-b}),h.push(-1),i.push(dt_length_menu_all);var a=$("body").find(a).dataTable({language:dt_lang,processing:!0,retrieve:!0,serverSide:!0,paginate:!0,searchDelay:700,bDeferRender:!0,responsive:!0,autoWidth:!1,dom:"<'mbot25'B><'row'><'row'<'col-md-6'l><'col-md-6'f>r>t<'row'<'col-md-4'i>><'row'<'#colvis'>p>",pageLength:tables_pagination_limit,lengthMenu:[h,i],columnDefs:[{searchable:!1,targets:c},{sortable:!1,targets:d}],fnCreatedRow:function(a,b,c){$(a).attr("data-title",b.Data_Title),$(a).attr("data-toggle",b.Data_Toggle)},initComplete:function(b,c){var d=$(a),e=d.find("thead th:last-child"),f=d.find("thead th:first-child");e.text().trim()==options_string_translate&&e.addClass("not-export"),f.find('input[type="checkbox"]').length>0&&f.addClass("not-export")},order:f,ajax:{url:b,type:"POST",data:function(a){for(var b in e)a[b]=$(e[b]).val()}},buttons:get_dt_export_buttons(a)}),j=a.DataTable(),k=$(a).find("th.not_visible");return $.each(k,function(){j.columns(this.cellIndex).visible(!1,!1)}),$(g).is(":hidden")&&$(g).find(".dataTables_empty").attr("colspan",$(g).find("thead th").length),j}}function task_single_update_tags(){var a=$("#taskTags");$.post(admin_url+"tasks/update_tags",{tags:a.tagit("assignedTags"),task_id:a.attr("data-taskid")})}function task_attachments_toggle(){$("body").find(".task-attachments-more").toggleClass("hide"),$("body").find(".task-attachments-less").toggleClass("hide")}function update_todo_items(){var a=$(".unfinished-todos li:not(.no-todos)"),b=$(".finished-todos li:not(.no-todos)"),c=1;$.each(a,function(){$(this).find('input[name="todo_order"]').val(c),$(this).find('input[name="finished"]').val(0),c++}),0==a.length?($(".nav-total-todos").addClass("hide"),$(".unfinished-todos li.no-todos").removeClass("hide")):a.length>0&&($(".unfinished-todos li.no-todos").hasClass("hide")||$(".unfinished-todos li.no-todos").addClass("hide"),$(".nav-total-todos").removeClass("hide"),$(".nav-total-todos").html(a.length)),x=1,$.each(b,function(){$(this).find('input[name="todo_order"]').val(x),$(this).find('input[name="finished"]').val(1),$(this).find('input[type="checkbox"]').prop("checked",!0),c++,x++}),0==b.length?$(".finished-todos li.no-todos").removeClass("hide"):b.length>0&&($(".finished-todos li.no-todos").hasClass("hide")||$(".finished-todos li.no-todos").addClass("hide"));var d=[];$.each(a,function(){var a=$(this).find('input[name="todo_id"]').val(),b=$(this).find('input[name="todo_order"]').val(),c=$(this).find('input[name="finished"]').val(),e=$(this).find(".todo-description");e.hasClass("line-throught")&&e.removeClass("line-throught"),$(this).find('input[type="checkbox"]').prop("checked",!1),d.push([a,b,c])}),$.each(b,function(){var a=$(this).find('input[name="todo_id"]').val(),b=$(this).find('input[name="todo_order"]').val(),c=$(this).find('input[name="finished"]').val(),e=$(this).find(".todo-description");e.hasClass("line-throught")||e.addClass("line-throught"),d.push([a,b,c])}),data={},data.data=d,$.post(admin_url+"todo/update_todo_items_order",data)}function delete_todo_item(a,b){$.get(admin_url+"todo/delete_todo_item/"+b,function(b){1==b.success&&($(a).parents("li").remove(),update_todo_items())},"json")}function edit_todo_item(a){$.get(admin_url+"todo/get_by_id/"+a,function(a){var b=$("#__todo");b.find('input[name="todoid"]').val(a.todoid),b.find('textarea[name="description"]').val(a.description),b.modal("show")},"json")}function init_datepicker(){var a=$(".datepicker"),b=$(".datetimepicker");if(0!=b.length||0!=a.length){$.each(a,function(){var a={format:date_format,timepicker:!1,scrollInput:!1,lazyInit:!0,dayOfWeekStart:calendar_first_day},b=$(this).data("date-end-date"),c=$(this).data("date-min-date");b&&(a.maxDate=b),c&&(a.minDate=c),$(this).datetimepicker(a)});var c;$.each(b,function(){c={format:date_format+" H:i",lazyInit:!0,scrollInput:!1,dayOfWeekStart:calendar_first_day};var a=$(this).data("date-end-date"),b=$(this).data("date-min-date");a&&(c.maxDate=a),b&&(c.minDate=b),$(this).datetimepicker(c)})}}function init_tags_inputs(){var a=$("body").find("input.tagsinput");a.tagit({availableTags:availableTags,allowSpaces:!0,animate:!1,placeholderText:tag_string,showAutocompleteOnFocus:!0,caseSensitive:!1,afterTagAdded:function(a,b){var c=availableTags.indexOf($.trim($(b.tag).find(".tagit-label").text()));if(c>-1){var d=availableTagsIds[c];$(b.tag).addClass("tag-id-"+d)}}})}function init_color_pickers(){$("body").find(".colorpicker-input").colorpicker({format:"hex"})}function init_selectpicker(){$("body").find(".selectpicker").selectpicker({showSubtext:!0}),$(".selectpicker.auto-toggle").not(".toggled").selectpicker("toggle").addClass("toggled")}function dt_custom_view(a,b,c,d){var e;e="undefined"==typeof c?"custom_view":c,"undefined"!=typeof d&&($("._filters input").val(""),$("._filter_data li.active").removeClass("active"));var f=do_filter_active(e);f!=e&&(a=""),$('input[name="'+e+'"]').val(a),$(b).DataTable().ajax.reload()}function do_filter_active(a,b){if(""!=a&&"undefined"!=typeof a){$('[data-cview="all"]').parents("li").removeClass("active");var c=$('[data-cview="'+a+'"]');if("undefined"!=typeof b&&(c=$(b+' [data-cview="'+a+'"]')),c.parents("li").not(".dropdown-submenu").hasClass("active")){c.parents("li").not(".dropdown-submenu").removeClass("active");var d=c.parents("li.dropdown-submenu");d.length>0&&0==d.find("li.active").length&&d.removeClass("active"),a=""}else c.parents("li").addClass("active");return a}return $("._filters input").val(""),$("._filter_data li.active").removeClass("active"),$('[data-cview="all"]').parents("li").addClass("active"),""}function init_roles_permissions(a,b){"undefined"==typeof a&&(a=$('select[name="role"]').val());var c=$('.member > input[name="isedit"]');if(!(c.length>0&&"undefined"!=typeof a&&"undefined"==typeof b)&&""!=a){var d=$("table.roles").find("tr");$.get(admin_url+"misc/get_role_permissions_ajax/"+a).done(function(a){a=JSON.parse(a);var b,c;$.each(d,function(){var d=$(this).data("id"),e=$(this);$.each(a,function(a,f){d==f.permissionid&&(b=1==f.can_view,c=1==f.can_view_own,e.find("[data-can-view]").prop("checked",b),1==b&&e.find("[data-can-view]").change(),e.find("[data-can-view-own]").prop("checked",c),1==c&&e.find("[data-can-view-own]").change(),e.find("[data-can-edit]").prop("checked",1==f.can_edit),e.find("[data-can-create]").prop("checked",1==f.can_create),e.find("[data-can-delete]").prop("checked",1==f.can_delete))})})})}}function hidden_input(a,b){return'<input type="hidden" name="'+a+'" value="'+b+'">'}function toggle_small_view(a,b){$("body").toggleClass("small-table");var c=$("#small-table"),d=!1;c.hasClass("col-md-5")?(c.removeClass("col-md-5"),c.addClass("col-md-12"),d=!0,$(".toggle-small-view").find("i").removeClass("fa fa-angle-double-right").addClass("fa fa-angle-double-left")):(c.addClass("col-md-5"),c.removeClass("col-md-12"),$(".toggle-small-view").find("i").removeClass("fa fa-angle-double-left").addClass("fa fa-angle-double-right"));var e=$(a).DataTable();e.columns(hidden_columns).visible(d,!1),e.columns.adjust(),$(b).toggleClass("hide")}function stripTags(a){var b=document.createElement("DIV");return b.innerHTML=a,b.textContent||b.innerText||""}function empty(a){if("number"==typeof a||"boolean"==typeof a)return!1;if("undefined"==typeof a||null===a)return!0;if("undefined"!=typeof a.length)return 0==a.length;var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return 0==b}function is_mobile(){return _is_mobile}function logout(){var a=$(".started-timers-top").find("li.timer").length;return a>0?($(".timers-modal-logout").modal("show"),!1):void(window.location.href=site_url+"authentication/logout")}function color(a,b,c){return"rgb("+a+","+b+","+c+")"}function buildUrl(a,b){var c="";for(var d in b){var e=b[d];c+=encodeURIComponent(d)+"="+encodeURIComponent(e)+"&"}return c.length>0&&(c=c.substring(0,c.length-1),a=a+"?"+c),a}function decimalToHM(a){var b=parseInt(Number(a)),c=Math.round(60*(Number(a)-b));return(b<10?"0"+b:b)+":"+(c<10?"0"+c:c)}function elFinderBrowser(a,b,c,d){return tinymce.activeEditor.windowManager.open({file:admin_url+"misc/tinymce_file_browser",title:media_files,width:900,height:450,resizable:"yes"},{setUrl:function(b){d.document.getElementById(a).value=b}}),!1}function init_editor(a,b){"undefined"==typeof a&&(a=".tinymce");var c=$(a);if(0!=c.length){$.each(c,function(){$(this).hasClass("tinymce-manual")&&$(this).removeClass("tinymce")});var d={selector:a,height:400,theme:"modern",skin:"perfex",language:tinymce_lang,relative_urls:!1,inline_styles:!0,verify_html:!1,cleanup:!1,valid_elements:"+*[*]",valid_children:"+body[style], +style[type]",apply_source_formatting:!1,remove_script_host:!1,removed_menuitems:"newdocument",forced_root_block:!1,fontsize_formats:"8pt 10pt 12pt 14pt 18pt 24pt 36pt",setup:function(a){a.on("init",function(){this.getDoc().body.style.fontSize="14px"}),a.addMenuItem("codesample",{text:"Insert/Edit code sample",context:"insert",icon:"codesample",onclick:function(){tinyMCE.execCommand("codesample")}}),a.addButton("alignment",{type:"listbox",text:tinymce.util.I18n.translate("Alignment"),icon:!1,onselect:function(a){tinyMCE.execCommand(this.value())},values:[{icon:"alignleft",value:"JustifyLeft"},{icon:"alignright",value:"JustifyRight"},{icon:"aligncenter",value:"JustifyCenter"},{icon:"alignjustify",value:"JustifyFull"}],onPostRender:function(){this.value("JustifyLeft")}})},table_default_styles:{width:"100%"},plugins:["advlist autoresize autolink lists link image charmap print preview hr anchor codesample","searchreplace wordcount visualblocks visualchars code fullscreen","media nonbreaking save table contextmenu directionality","paste textcolor colorpicker textpattern"],toolbar1:"fontselect fontsizeselect | forecolor backcolor | bold italic | link image | bullist numlist | alignment | rtl",file_browser_callback:elFinderBrowser};if("true"==isRTL?d.directionality="rtl":"","undefined"!=typeof b)for(var e in b)d[e]=b[e];var f=tinymce.init(d);return f}}function _formatMenuIconInput(a){if("undefined"!=typeof a){var b=$(a.target);b.val().match(/^fa /)||b.val("fa "+b.val())}}function mass_delete(a){var b=confirm(confirm_action_prompt);if(0==b)return!1;var c=[],d=$(".table-"+a).find("tbody tr");$.each(d,function(){var a=$($(this).find("td").eq(0)).find("input");1==a.prop("checked")&&c.push(a.val())});var e={};e.ids=c,$.post(admin_url+a+"/mass_delete",e).done(function(){window.location.reload()})}function showPassword(a){var b=$('input[name="'+a+'"]');"password"==$(b).attr("type")&&""!=$(b).val()?$(b).queue(function(){$(b).attr("type","text").dequeue()}):$(b).queue(function(){$(b).attr("type","password").dequeue()})}function init_btn_with_tooltips(){if(is_mobile()){var a=$("._buttons").find(".btn-with-tooltip");$.each(a,function(){var a=$(this).attr("title");"undefined"==typeof a&&(a=$(this).attr("data-title")),"undefined"!=typeof a&&($(this).append(" "+a),$(this).removeClass("btn-with-tooltip"))});var b=$("._buttons").find(".btn-with-tooltip-group");$.each(b,function(){var a=$(this).attr("title");"undefined"==typeof a&&(a=$(this).attr("data-title")),"undefined"!=typeof a&&($(this).find(".btn").eq(0).append(" "+a),$(this).removeClass("btn-with-tooltip-group"))})}}function do_hash_helper(a){if("undefined"!=typeof history.pushState){var b=window.location.href,c={Url:b};history.pushState(c,"",c.Url),window.location.hash=a}}function manage_kb_groups(a){var b=$(a).serialize(),c=a.action;return $.post(c,b).done(function(a){window.location.reload()}),!1}function new_kb_group(){$("#kb_group_modal").modal("show"),$(".edit-title").addClass("hide")}function edit_kb_group(a,b){$("#additional").append(hidden_input("id",b)),$('#kb_group_modal input[name="name"]').val($(a).data("name")),$('#kb_group_modal textarea[name="description"]').val($(a).data("description")),$("#kb_group_modal .colorpicker-input").colorpicker("setValue",$(a).data("color")),$('#kb_group_modal input[name="group_order"]').val($(a).data("order"));var c=$(a).data("active");0==c?$('input[name="disabled"]').prop("checked",!0):$('input[name="disabled"]').prop("checked",!1),$("#kb_group_modal").modal("show"),$(".add-title").addClass("hide")}function init_form_reminder(){_validate_form($("#form-reminder"),{date:"required",staff:"required"},reminderFormHandler)}function reminderFormHandler(a){a=$(a);var b=a.serialize(),c=$(a).serializeArray();return $.post(a.attr("action"),b).done(function(a){a=JSON.parse(a),alert_float(a.alert_type,a.message),$.each(available_reminders_table,function(a,b){$.fn.DataTable.isDataTable(b)&&$("body").find(b).DataTable().ajax.reload()})}),$(".reminder-modal-"+c[1].value+"-"+c[0].value).modal("hide"),!1}function close_modal_manualy(a){a=0==$(a).length?$("body").find(a):$(a),a.fadeOut("fast",function(){a.remove(),$("body").find(".modal").is(":visible")||($(".modal-backdrop").remove(),$("body").removeClass("modal-open"))})}function toggle_edit_note(a){$("body").find('[data-note-edit-textarea="'+a+'"]').toggleClass("hide"),$("body").find('[data-note-description="'+a+'"]').toggleClass("hide")}function edit_note(a){var b=$("body").find('[data-note-edit-textarea="'+a+'"] textarea').val();""!=b&&($.post(admin_url+"misc/edit_note/"+a,{description:b}).done(function(c){c=JSON.parse(c),1==c.success&&(alert_float("success",c.message),$("body").find('[data-note-description="'+a+'"]').html(nl2br(b)))}),toggle_edit_note(a))}function toggle_file_visibility(a,b,c){$.get(admin_url+"misc/toggle_file_visibility/"+a,function(a){1==a?$(c).find("i").removeClass("fa fa-toggle-off").addClass("fa fa-toggle-on"):$(c).find("i").removeClass("fa fa-toggle-on").addClass("fa fa-toggle-off")})}function nl2br(a,b){var c=b||"undefined"==typeof b?"<br />":"<br>";return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+c+"$2")}function fix_kanban_height(a,b){$("body").find("div.dt-loader").remove();var c=$(".kan-ban-content-wrapper");c.css("max-height",window.innerHeight-a+"px"),$(".kan-ban-content").css("min-height",window.innerHeight-a+"px");var d=parseInt(c.length);$(".container-fluid").css("min-width",d*b+"px")}function kanban_load_more(a,b,c,d,e){var f,g=new Array,h=$('input[name="search"]').val(),i=$(b).attr("data-page"),j=$('[data-col-status-id="'+a+'"]').data("total-pages");if(i<=j){var k=$('input[name="sort_type"]'),l=$('input[name="sort"]').val();0!=k.length&&""!=k.val()&&(g.sort_by=k.val(),g.sort=l),""!=h&&(g.search=h),$.each($("#kanban-params input"),function(){f=$(this).val(),""!=f&&(g[$(this).attr("name")]=f)}),g.status=a,g.page=i,g.page++,$.get(buildUrl(admin_url+c,g),function(c){i++,$('[data-load-status="'+a+'"]').before(c),$(b).attr("data-page",i),fix_kanban_height(d,e)}),i>=j-1&&$(b).addClass("disabled")}}function check_kanban_empty_col(a){var b=$("[data-col-status-id]");$.each(b,function(b,c){var d=$(c).find(a).length;0==d?($(c).find(".kanban-empty").removeClass("hide"),$(c).find(".kanban-load-more").addClass("hide")):$(c).find(".kanban-empty").addClass("hide")})}function init_kanban(a,b,c,d,e,f){if(0!=$("#kan-ban").length){var g,h=new Array;$.each($("#kanban-params input"),function(){g=$(this).val(),""!=g&&(h[$(this).attr("name")]=g)});var i=$('input[name="search"]').val();""!==i&&(h.search=i);var j=$('input[name="sort_type"]'),k=$('input[name="sort"]').val();0!=j.length&&""!=j.val()&&(h.sort_by=j.val(),h.sort=k),h.kanban=!0;var a=admin_url+a;a=buildUrl(a,h),delay(function(){$("body").append('<div class="dt-loader"></div>'),$("#kan-ban").load(a,function(){fix_kanban_height(d,e),"undefined"!=typeof f&&f(),$(".status").sortable({connectWith:c,helper:"clone",appendTo:"#kan-ban",placeholder:"ui-state-highlight-card",revert:"invalid",scroll:!0,scrollSensitivity:50,scrollSpeed:70,drag:function(a,b){var c=parseInt($(this).data("startingScrollTop"));b.position.top-=$(this).parent().scrollTop()-c},start:function(a,b){$(b.helper).addClass("tilt"),$(b.helper).find(".panel-body").css("background","#fbfbfb"),tilt_direction($(b.helper))},stop:function(a,b){$(b.helper).removeClass("tilt"),$("html").unbind("mousemove",$(b.helper).data("move_handler")),$(b.helper).removeData("move_handler")},update:function(a,c){b(c,this)}}),$(".status").sortable({cancel:".not-sortable"})})},200)}}function tilt_direction(a){setTimeout(function(){var b=a.position().left,c=function(c){c.pageX>=b?(a.addClass("right"),a.removeClass("left")):(a.addClass("left"),a.removeClass("right")),b=c.pageX};$("html").bind("mousemove",c),a.data("move_handler",c)},1e3)}function init_newsfeed_form(){"undefined"==typeof newsFeedDropzone&&$("body").on("submit","#new-post-form",function(){return $.post(this.action,$(this).serialize()).done(function(a){if(a=JSON.parse(a),a.postid){if(newsFeedDropzone.getQueuedFiles().length>0)return newsFeedDropzone.options.url=admin_url+"newsfeed/add_post_attachments/"+a.postid,void newsFeedDropzone.processQueue();newsfeed_new_post(a.postid),clear_newsfeed_post_area()}}),!1}),newsFeedDropzone=new Dropzone("#new-post-form",{clickable:".add-post-attachments",autoProcessQueue:!1,addRemoveLinks:!0,parallelUploads:newsfeed_maximum_files_upload,maxFiles:newsfeed_maximum_files_upload,maxFilesize:newsfeed_maximum_file_size,acceptedFiles:allowed_files,dictDefaultMessage:drop_files_here_to_upload,dictFallbackMessage:browser_not_support_drag_and_drop,dictRemoveFile:remove_file,dictMaxFilesExceeded:you_can_not_upload_any_more_files}),newsFeedDropzone.on("success",function(a,b){total_new_post_files--,0==total_new_post_files&&(b=JSON.parse(b),newsfeed_new_post(b.postid),clear_newsfeed_post_area(),newsFeedDropzone.removeAllFiles())}),newsFeedDropzone.on("dragover",function(a){$("#new-post-form").addClass("dropzone-active")}),newsFeedDropzone.on("drop",function(a){$("#new-post-form").removeClass("dropzone-active")}),newsFeedDropzone.on("error",function(a,b){total_new_post_files--,alert_float("danger",b)}),newsFeedDropzone.on("removedfile",function(a){total_new_post_files--}),newsFeedDropzone.on("addedfile",function(a){0==this.getQueuedFiles().length&&(total_new_post_files=0),total_new_post_files++})}function clear_newsfeed_post_area(){$("#new-post-form textarea").val(""),$("#post-visibility").selectpicker("val","all")}function load_post_likes(a){track_load_post_likes<=post_likes_total_pages&&($.post(admin_url+"newsfeed/load_likes_modal",{page:track_load_post_likes,postid:a}).done(function(a){track_load_post_likes++,$("#modal_post_likes_wrapper").append(a)}),track_load_post_likes>=post_likes_total_pages-1&&$(".likes_modal .modal-footer").addClass("hide"))}function load_comment_likes(a){track_load_comment_likes<=comment_likes_total_pages&&($.post(admin_url+"newsfeed/load_comment_likes_model",{page:track_load_comment_likes,commentid:a}).done(function(a){track_load_comment_likes++,$("#modal_comment_likes_wrapper").append(a)}),track_load_comment_likes>=comment_likes_total_pages-1&&$(".likes_modal .modal-footer").addClass("hide"))}function load_more_comments(a){var b=$(a).data("postid"),c=$(a).find('input[name="page"]').val(),d=$(a).data("total-pages");c<=d&&($.post(admin_url+"newsfeed/init_post_comments/"+b,{page:c}).done(function(d){$(a).data("track-load-comments",c),$('[data-comments-postid="'+b+'"] .load-more-comments').before(d)}),c++,$(a).find('input[name="page"]').val(c),c>=d-1&&($(a).addClass("hide"),$(a).removeClass("display-block")))}function newsfeed_new_post(a){var b={};b.postid=a,$.post(admin_url+"newsfeed/load_newsfeed",b).done(function(a){var b=$("#newsfeed_data").find(".pinned"),c=b.length;if(0==c)$("#newsfeed_data").prepend(a);else{var d=$("#newsfeed_data").find(".pinned").eq(c-1);$(d).after(a)}})}function load_newsfeed(a){var b={};b.page=newsfeed_posts_page,"undefined"!=typeof a&&0!=a&&(b.postid=a);var c=$('input[name="total_pages_newsfeed"]').val();newsfeed_posts_page<=c&&($.post(admin_url+"newsfeed/load_newsfeed",b).done(function(a){newsfeed_posts_page++,$("#newsfeed_data").append(a)}),newsfeed_posts_page>=c-1)}function like_post(a){$.get(admin_url+"newsfeed/like_post/"+a,function(b){1==b.success&&refresh_post_likes(a)},"json")}function unlike_post(a){$.get(admin_url+"newsfeed/unlike_post/"+a,function(b){1==b.success&&refresh_post_likes(a)},"json")}function like_comment(a,b){$.get(admin_url+"newsfeed/like_comment/"+a+"/"+b,function(b){1==b.success&&$('[data-commentid="'+a+'"]').replaceWith(b.comment)},"json")}function unlike_comment(a,b){$.get(admin_url+"newsfeed/unlike_comment/"+a+"/"+b,function(b){1==b.success&&$('[data-commentid="'+a+'"]').replaceWith(b.comment)},"json")}function add_comment(a){var b=$(a).data("postid");$.post(admin_url+"newsfeed/add_comment",{content:$(a).val(),postid:b}).done(function(c){c=JSON.parse(c),1==c.success&&($(a).val(""),$("body").find('[data-comments-postid="'+b+'"] .post-comment').length>0?$("body").find('[data-comments-postid="'+b+'"] .post-comment').prepend(c.comment):refresh_post_comments(b))})}function remove_post_comment(a,b){$.get(admin_url+"newsfeed/remove_post_comment/"+a+"/"+b,function(b){1==b.success&&$('.comment[data-commentid="'+a+'"]').remove()},"json")}function refresh_post_likes(a){$.get(admin_url+"newsfeed/init_post_likes/"+a+"?refresh_post_likes=true",function(b){$('[data-likes-postid="'+a+'"]').html(b)})}function refresh_post_comments(a){$.post(admin_url+"newsfeed/init_post_comments/"+a+"?refresh_post_comments=true").done(function(b){$('[data-comments-postid="'+a+'"]').html(b)})}function delete_post(a){var b=confirm(confirm_action_prompt);return 0!=b&&void $.post(admin_url+"newsfeed/delete_post/"+a,function(b){1==b.success&&$('[data-main-postid="'+a+'"]').remove()},"json")}function pin_post(a){$.get(admin_url+"newsfeed/pin_newsfeed_post/"+a,function(a){1==a.success&&window.location.reload()},"json")}function unpin_post(a){$.get(admin_url+"newsfeed/unpin_newsfeed_post/"+a,function(a){1==a.success&&window.location.reload()},"json")}function init_lead(a){init_lead_modal_data(a)&&$(".lead-modal").modal("show")}function validate_lead_form(a){_validate_form($("#lead_form"),{name:"required",status:{required:{depends:function(a){return!($("[lead-is-junk-or-lost]").length>0)}}},source:"required",email:{email:!0,remote:{url:admin_url+"leads/email_exists",type:"post",data:{email:function(){return $('input[name="email"]').val()},leadid:function(){return $('input[name="leadid"]').val()}}}}},a)}function validate_lead_convert_to_client_form(){var a={firstname:"required",lastname:"required",password:{required:{depends:function(a){var b=$('input[name="send_set_password_email"]');if(0==b.prop("checked"))return!0}}},email:{required:!0,email:!0,remote:{url:site_url+"admin/misc/contact_email_exists",type:"post",data:{email:function(){return $('#lead_to_client_form input[name="email"]').val()},userid:""}}}};1==company_is_required&&(a.company="required"),_validate_form($("#lead_to_client_form"),a)}function lead_profile_form_handler(a){a=$(a);var b=a.serialize(),c=($(a).serializeArray(),$(".lead-modal").find('input[name="leadid"]').val());return $.post(a.attr("action"),b).done(function(a){a=JSON.parse(a),a.id&&(c=a.id),""!=a.message&&alert_float("success",a.message),a.proposal_warning&&0!=a.proposal_warning?($("body").find("#lead_proposal_warning").removeClass("hide"),$("body").find(".lead-modal").animate({scrollTop:0},800)):init_lead_modal_data(c),$.fn.DataTable.isDataTable(".table-leads")&&$(".table-leads").DataTable().ajax.reload()}).fail(function(a){return alert_float("danger",a.responseText),!1}),!1}function update_all_proposal_emails_linked_to_lead(a){$.post(admin_url+"leads/update_all_proposal_emails_linked_to_lead/"+a,{update:!0}).done(function(b){b=JSON.parse(b),b.success&&alert_float("success",b.message),init_lead_modal_data(a)})}function init_lead_modal_data(a,b){"undefined"==typeof a&&(a="");var c=admin_url+"leads/lead/"+a;"undefined"!=typeof b&&(c=b);var d=window.location.hash;$.get(c,function(b){$(".lead-modal .modal-content").html(b.data),$("#lead_reminder_modal").html(b.reminder_data),$(".lead-modal").modal({show:!0,backdrop:"static"}),init_selectpicker(),init_form_reminder(),init_datepicker(),init_color_pickers(),validate_lead_form(lead_profile_form_handler),"#tab_lead_profile"!=d&&"#attachments"!=d&&"#lead_notes"!=d||(window.location.hash=d),""!=a&&("undefined"!=typeof Dropbox&&document.getElementById("dropbox-chooser-lead").appendChild(Dropbox.createChooseButton({success:function(b){$.post(admin_url+"leads/add_external_attachment",{files:b,lead_id:a,external:"dropbox"}).done(function(){init_lead_modal_data(a)})},linkType:"preview",extensions:allowed_files.split(",")})),"undefined"!=typeof leadAttachmentsDropzone&&leadAttachmentsDropzone.destroy(),leadAttachmentsDropzone=new Dropzone("#lead-attachment-upload",{addRemoveLinks:!1,dictDefaultMessage:drop_files_here_to_upload,dictFallbackMessage:browser_not_support_drag_and_drop,dictRemoveFile:remove_file,dictMaxFilesExceeded:you_can_not_upload_any_more_files,sending:function(b,c,d){d.append("leadid",a)},acceptedFiles:allowed_files,error:function(a,b){alert_float("danger",b)},success:function(b){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&init_lead_modal_data(a)}}),$("body").find('.nav-tabs a[href="'+window.location.hash+'"]').tab("show"),$("#lead-latest-activity").html($("#lead_activity").find(".feed-item:last-child .text").html()))},"json").fail(function(a){$(".lead-modal").modal("hide"),alert_float("danger",a.responseText)})}function leads_kanban_sort(a){var b=$('input[name="sort_type"]'),c=$('input[name="sort"]');
b.val(a),"ASC"==c.val()?c.val("DESC"):"DESC"==c.val()?c.val("ASC"):c.val("DESC"),leads_kanban()}function leads_kanban_update(a,b){if(b===a.item.parent()[0]){var c={};c.status=$(a.item.parent()[0]).data("lead-status-id"),c.leadid=$(a.item).data("lead-id");var d=[],e=$(a.item).parents(".leads-status").find("li"),f=1;$.each(e,function(){d.push([$(this).data("lead-id"),f]),f++}),c.order=d,setTimeout(function(){$.post(admin_url+"leads/update_kan_ban_lead_status",c).done(function(a){check_kanban_empty_col("[data-lead-id]")})},200)}}function init_leads_status_sortable(){$("#kan-ban").sortable({helper:"clone",item:".kan-ban-col",update:function(a,b){var c=[],d=$(".kan-ban-col"),e=0;$.each(d,function(){c.push([$(this).data("col-status-id"),e]),e++});var f={};f.order=c,$.post(admin_url+"leads/update_status_order",f)}})}function leads_kanban(a){init_kanban("leads",leads_kanban_update,".leads-status",290,360,init_leads_status_sortable)}function delete_lead_attachment(a,b){var c=confirm(confirm_action_prompt);return 0!=c&&void $.get(admin_url+"leads/delete_attachment/"+b,function(b){1==b.success&&$(a).parents(".lead-attachment-wrapper").remove()},"json")}function delete_lead_note(a,b){var c=confirm(confirm_action_prompt);return 0!=c&&void $.get(admin_url+"leads/delete_note/"+b,function(b){1==b.success&&$(a).parents(".lead-note").remove()},"json")}function lead_mark_as_lost(a){$.get(admin_url+"leads/mark_as_lost/"+a,function(b){1==b.success&&alert_float("success",b.message),init_lead_modal_data(a)},"json")}function lead_unmark_as_lost(a){$.get(admin_url+"leads/unmark_as_lost/"+a,function(b){1==b.success&&alert_float("success",b.message),init_lead_modal_data(a)},"json")}function lead_mark_as_junk(a){$.get(admin_url+"leads/mark_as_junk/"+a,function(b){1==b.success&&alert_float("success",b.message),init_lead_modal_data(a)},"json")}function lead_unmark_as_junk(a){$.get(admin_url+"leads/unmark_as_junk/"+a,function(b){1==b.success&&alert_float("success",b.message),init_lead_modal_data(a)},"json")}function manage_leads_statuses(a){var b=$(a).serialize(),c=a.action;return $.post(c,b).done(function(a){window.location.reload()}),!1}function convert_lead_to_customer(a){$(".lead-modal").modal("hide"),$.get(admin_url+"leads/get_convert_data/"+a,function(a){$("#lead_convert_to_customer").html(a),$("#convert_lead_to_client_modal").modal({show:!0,backdrop:"static",keyboard:!1})})}function new_status(){$("#status").modal("show"),$(".edit-title").addClass("hide")}function edit_status(a,b){$("#additional").append(hidden_input("id",b)),$('#status input[name="name"]').val($(a).data("name")),$("#status .colorpicker-input").colorpicker("setValue",$(a).data("color")),$('#status input[name="statusorder"]').val($(a).data("order")),$("#status").modal("show"),$(".add-title").addClass("hide")}function leads_bulk_action(a){var b=confirm(confirm_action_prompt);if(0==b)return!1;var c=$("#mass_delete").prop("checked"),d=[],e={};if(0==c||"undefined"==typeof c){if(e.status=$("#move_to_status_leads_bulk").val(),e.assigned=$("#assign_to_leads_bulk").val(),e.source=$("#move_to_source_leads_bulk").val(),e.last_contact=$("#leads_bulk_last_contact").val(),"undefined"==typeof e.assigned&&(e.assigned=""),""==e.status&&""==e.assigned&&""==e.source&&""==e.last_contact)return}else e.mass_delete=!0;var f=$(".table-leads").find("tbody tr");$.each(f,function(){var a=$($(this).find("td").eq(0)).find("input");1==a.prop("checked")&&d.push(a.val())}),e.ids=d,$(a).addClass("disabled"),setTimeout(function(){$.post(admin_url+"leads/bulk_action",e).done(function(){window.location.reload()})},200)}function sync_proposals_data(a,b){var c={},d=$("#sync_data_proposal_data");c.country=d.find('select[name="country"]').val(),c.zip=d.find('input[name="zip"]').val(),c.state=d.find('input[name="state"]').val(),c.city=d.find('input[name="city"]').val(),c.address=d.find('input[name="address"]').val(),c.phone=d.find('input[name="phone"]').val(),c.rel_id=a,c.rel_type=b,$.post(admin_url+"proposals/sync_data",c).done(function(a){a=JSON.parse(a),alert_float("success",a.message),d.modal("hide")})}function init_table_announcements(a){return("undefined"!=typeof a||!$("body").hasClass("home"))&&void initDataTable(".table-announcements",admin_url+"announcements",[2],[2],"undefined",[1,"DESC"])}function init_table_tickets(a){if("undefined"==typeof a&&$("body").hasClass("home"))return!1;if(0!=$("body").find(".tickets-table").length){var b=$(".tickets-table").find("th").length-1,c={},d=$("._hidden_inputs._filters.tickets_filters input"),e=$("table.tickets-table thead .ticket_created_column").index();$.each(d,function(){c[$(this).attr("name")]='[name="'+$(this).attr("name")+'"]'}),c.project_id='[name="project_id"]';var f=[b],g=admin_url+"tickets";$("body").hasClass("tickets_page")&&(f.push(0),g+="?bulk_actions=true"),_table_api=initDataTable(".tickets-table",g,f,f,c,[e,"DESC"]),_table_api&&$("body").hasClass("home")&&_table_api.column(b).visible(!1,!1).column(3).visible(!1,!1).column(e).visible(!1,!1).column(4).visible(!1,!1).columns.adjust()}}function init_table_staff_projects(a){if("undefined"==typeof a&&$("body").hasClass("home"))return!1;if(0!=$("body").find(".table-staff-projects").length){var b={},c=$("._hidden_inputs._filters.staff_projects_filter input");$.each(c,function(){b[$(this).attr("name")]='[name="'+$(this).attr("name")+'"]'}),initDataTable(".table-staff-projects",admin_url+"projects/staff_projects","undefined","undefined",b,[2,"ASC"])}}function do_task_checklist_items_height(a){"undefined"==typeof a&&(a=$("body").find("textarea[name='checklist-description']")),$.each(a,function(){var a=$(this).val();$(this).outerHeight()<this.scrollHeight+parseFloat($(this).css("borderTopWidth"))+parseFloat($(this).css("borderBottomWidth"))&&($(this).height(0).height(this.scrollHeight),$(this).parents(".checklist").height(this.scrollHeight)),""==a&&($(this).removeAttr("style"),$(this).parents(".checklist").removeAttr("style"))})}function recalculate_checklist_items_progress(){var a=$('input[name="checklist-box"]:checked').length,b=$('input[name="checklist-box"]').length,c=0,d=$(".task-progress-bar");return 0==b?($("body").find(".chk-heading").remove(),$("#task-no-checklist-items").removeClass("hide")):$("#task-no-checklist-items").addClass("hide"),b>2?(d.parents(".progress").removeClass("hide"),c=100*a/b,d.css("width",c.toFixed(2)+"%"),void d.text(c.toFixed(2)+"%")):(d.parents(".progress").addClass("hide"),!1)}function delete_checklist_item(a,b){var c=confirm(confirm_action_prompt);return 0!=c&&void $.get(admin_url+"tasks/delete_checklist_item/"+a,function(a){1==a.success&&($(b).parents(".checklist").remove(),recalculate_checklist_items_progress())},"json")}function add_task_checklist_item(a){$.post(admin_url+"tasks/add_checklist_item",{taskid:a}).done(function(){init_tasks_checklist_items(!0,a)})}function init_tasks_checklist_items(a,b){$.post(admin_url+"tasks/init_checklist_items",{taskid:b}).done(function(b){$("#checklist-items").html(b),"undefined"!=typeof a&&$("body").find(".checklist textarea").eq(0).focus(),recalculate_checklist_items_progress(),update_checklist_order()})}function remove_task_attachment(a,b){var c=confirm(confirm_action_prompt);return 0!=c&&void $.get(admin_url+"tasks/remove_task_attachment/"+b,function(b){1==b.success&&$(a).parents(".task-attachment-col").remove();var c=$("body").find(".task_attachments_wrapper"),d=c.find(".task-attachment-col");0==d.length?c.remove():2==d.length&&$("body").find("#show-more-less-task-attachments-col .task-attachments-more").hasClass("hide")&&$("body").find("#show-more-less-task-attachments-col").remove()},"json")}function add_task_comment(a){var b={};b.content=tinyMCE.activeEditor.getContent(),b.taskid=a,$.post(admin_url+"tasks/add_task_comment",b).done(function(b){init_task_modal(a)})}function remove_task_comment(a){var b=confirm(confirm_action_prompt);return 0!=b&&void $.get(admin_url+"tasks/remove_comment/"+a,function(b){1==b.success&&$('[data-commentid="'+a+'"]').remove()},"json")}function remove_assignee(a,b){var c=confirm(confirm_action_prompt);return 0!=c&&void $.get(admin_url+"tasks/remove_assignee/"+a+"/"+b,function(a){1==a.success?alert_float("success",a.message):alert_float("warning",a.message),init_task_modal(b)},"json")}function remove_follower(a,b){var c=confirm(confirm_action_prompt);return 0!=c&&void $.get(admin_url+"tasks/remove_follower/"+a+"/"+b,function(a){1==a.success&&(alert_float("success",a.message),init_task_modal(b))},"json")}function mark_complete(a){task_mark_as(5,a,admin_url+"tasks/mark_complete/"+a)}function unmark_complete(a){task_mark_as(4,a,admin_url+"tasks/unmark_complete/"+a)}function task_mark_as(a,b,c){"undefined"==typeof c&&(c=admin_url+"tasks/mark_as/"+a+"/"+b),$("body").append('<div class="dt-loader"></div>'),$.get(c,function(a){$("body").find(".dt-loader").remove(),1==a.success&&(reload_tasks_tables(),$(".task-modal-single").is(":visible")&&init_task_modal(b),0==$(".tasks-kanban").length&&alert_float("success",a.message))},"json")}function reload_tasks_tables(){$.fn.DataTable.isDataTable(".table-tasks")&&$(".table-tasks").DataTable().ajax.reload(),$.fn.DataTable.isDataTable(".table-rel-tasks")&&$(".table-rel-tasks").DataTable().ajax.reload(),$.fn.DataTable.isDataTable(".table-rel-tasks-leads")&&$(".table-rel-tasks-leads").DataTable().ajax.reload(),$.fn.DataTable.isDataTable(".table-timesheets")&&$(".table-timesheets").DataTable().ajax.reload()}function make_task_public(a){$.get(admin_url+"tasks/make_public/"+a,function(b){1==b.success&&(reload_tasks_tables(),init_task_modal(a))},"json")}function new_task(a){var b=admin_url+"tasks/task";"undefined"!=typeof a&&(b=a),$.get(b,function(a){$("#_task").html(a),$("body").find("#_task_modal").modal({show:!0,backdrop:"static"})})}function new_task_from_relation(a,b,c){"undefined"==typeof b&&"undefined"==typeof c&&(c=$(a).data("new-rel-id"),b=$(a).data("new-rel-type"));var d=admin_url+"tasks/task?rel_id="+c+"&rel_type="+b;new_task(d)}function edit_task(a){$.get(admin_url+"tasks/task/"+a,function(a){$("#_task").html(a),$(".task-modal-single").modal("hide"),$("body").find("#_task_modal").modal({show:!0,backdrop:"static"})})}function task_form_handler(a){tinymce.triggerSave();var b=$(a).serialize(),c=a.action;return $.post(c,b).done(function(a){if(a=JSON.parse(a),1==a.success&&alert_float("success",a.message),$("body").hasClass("project")){$("#_task_modal").modal("hide");var b=window.location.href,c=new Array;b=b.split("?");var d=get_url_param("group");d&&(c.group=d),c.taskid=a.id,window.location.href=buildUrl(b[0],c)}else $("#_task_modal").modal("hide"),init_task_modal(a.id),reload_tasks_tables()}).fail(function(a){var b=JSON.parse(a.responseText);alert_float("danger",b.message)}),!1}function timer_action(a,b,c){"undefined"==typeof c&&(c=""),$(a).addClass("disabled"),$.get(admin_url+"tasks/timer_tracking/"+b+"/"+c,function(c){$(a).removeClass("disabled"),$(".task-modal-single").is(":visible")&&init_task_modal(b),init_timers(),reload_tasks_tables()},"json")}function init_task_modal(a){tinymce.remove("#task_comment"),$.post(admin_url+"tasks/get_task_data/",{taskid:a}).done(function(b){$(".task-modal-single .data").html(b),init_editor("#task_comment",{height:150}),init_tasks_checklist_items(!1,a),setTimeout(function(){$(".task-modal-single").modal("show"),fix_task_modal_left_col_height()},150)}).fail(function(a){$(".task-modal-single").modal("hide"),alert_float("danger",a.responseText)})}function task_tracking_stats(a){$.get(admin_url+"tasks/task_tracking_stats/"+a,function(a){$("body").find("#tacking-stats").html(a),$("#task-tracking-stats-modal").modal("toggle")})}function init_timers(){$.get(admin_url+"tasks/get_staff_started_timers",function(a){a.timers_found?$(".top-timers").addClass("text-warning"):$(".top-timers").removeClass("text-warning"),$(".started-timers-top").html(a.html)},"json")}function edit_task_comment(a){var b=$('[data-edit-comment="'+a+'"]');b.next().addClass("hide"),b.removeClass("hide"),init_editor("#task_comment_"+a,{height:150}),tinymce.triggerSave()}function cancel_edit_comment(a){var b=$('[data-edit-comment="'+a+'"]');tinymce.remove('[data-edit-comment="'+a+'"] textarea'),b.addClass("hide"),b.next().removeClass("hide")}function save_edited_comment(a,b){tinymce.triggerSave();var c={};c.id=a,c.content=$('[data-edit-comment="'+a+'"]').find("textarea").val(),$.post(admin_url+"tasks/edit_comment",c).done(function(c){c=JSON.parse(c),1==c.success?(alert_float("success",c.message),init_task_modal(b)):cancel_edit_comment(a),tinymce.remove('[data-edit-comment="'+a+'"] textarea')})}function update_checklist_order(){var a=[],b=$("body").find(".checklist"),c=1;$.each(b,function(){a.push([$(this).data("checklist-id"),c]),c++});var d={};d.order=a,$.post(admin_url+"tasks/update_checklist_order",d)}function fix_task_modal_left_col_height(){var a=$("body").find(".task-single-col-left"),b=$("body").find(".task-single-col-right");a.css("min-height",b.outerHeight(!0)+"px")}function tasks_kanban_update(a,b){if(b===a.item.parent()[0]){var c=$(a.item.parent()[0]).data("task-status-id"),d=$(a.item.parent()[0]).find("[data-task-id]"),e={};e.order=[];var f=0;$.each(d,function(){e.order.push([$(this).data("task-id"),f]),f++}),task_mark_as(c,$(a.item).data("task-id")),check_kanban_empty_col("[data-task-id]"),setTimeout(function(){$.post(admin_url+"tasks/update_order",e)},200)}}function tasks_kanban(){init_kanban("tasks",tasks_kanban_update,".tasks-status",270,360)}function edit_task_inline_description(a,b){return tinyMCE.remove("#task_view_description"),$(a).hasClass("editor-initiated")?void $(a).removeClass("editor-initiated"):($(a).addClass("editor-initiated"),void tinymce.init({selector:"#task_view_description",theme:"inlite",skin:"perfex",auto_focus:"task_view_description",plugins:"table link paste contextmenu textpattern",insert_toolbar:"quicktable",selection_toolbar:"bold italic | quicklink h2 h3 blockquote",inline:!0,table_default_styles:{width:"100%"},setup:function(a){a.on("blur",function(c){a.isDirty()&&$.post(admin_url+"tasks/update_task_description/"+b,{description:a.getContent()}),setTimeout(function(){a.remove()},500)})}}))}function tasks_bulk_action(a){var b=confirm(confirm_action_prompt);if(0==b)return!1;var c=$("#mass_delete").prop("checked"),d=[],e={};if(0==c||"undefined"==typeof c){if(e.status=$("#move_to_status_tasks_bulk_action").val(),e.priority=$("#task_bulk_priority").val(),"undefined"==typeof e.priority&&(e.priority=""),""==e.status&&""==e.priority)return}else e.mass_delete=!0;var f=$(".table-tasks").find("tbody tr");$.each(f,function(){var a=$($(this).find("td").eq(0)).find("input");1==a.prop("checked")&&d.push(a.val())}),e.ids=d,$(a).addClass("disabled"),setTimeout(function(){$.post(admin_url+"tasks/bulk_action",e).done(function(){window.location.reload()})},200)}function init_invoice(a){var b=$('input[name="invoiceid"]').val();""==b||window.location.hash?window.location.hash&&!a&&(a=window.location.hash.substring(1)):(a=b,$('input[name="invoiceid"]').val("")),"undefined"!=typeof a&&""!=a&&($("body").hasClass("small-table")||toggle_small_view(".table-invoices","#invoice"),$('input[name="invoiceid"]').val(a),do_hash_helper(a),$("#invoice").load(admin_url+"invoices/get_invoice_data_ajax/"+a),is_mobile()&&$("html, body").animate({scrollTop:$("#invoice").offset().top+150},600))}function init_estimate(a){var b=$('input[name="estimateid"]').val();""==b||window.location.hash?window.location.hash&&!a&&(a=window.location.hash.substring(1)):(a=b,$('input[name="estimateid"]').val("")),"undefined"!=typeof a&&""!=a&&($("body").hasClass("small-table")||toggle_small_view(".table-estimates","#estimate"),$('input[name="estimateid"]').val(a),do_hash_helper(a),$("#estimate").load(admin_url+"estimates/get_estimate_data_ajax/"+a),is_mobile()&&$("html, body").animate({scrollTop:$("#estimate").offset().top+150},600))}function init_proposal(a){var b=$('input[name="proposal_id"]').val();""==b||window.location.hash?window.location.hash&&!a&&(a=window.location.hash.substring(1)):(a=b,$('input[name="proposal_id"]').val("")),"undefined"!=typeof a&&""!=a&&($("body").hasClass("small-table")||toggle_small_view(".table-proposals","#proposal"),$('input[name="proposal_id"]').val(a),do_hash_helper(a),$("#proposal").load(admin_url+"proposals/get_proposal_data_ajax/"+a),is_mobile()&&$("html, body").animate({scrollTop:$("#proposal").offset().top+150},600))}function clear_billing_and_shipping_details(){for(var a in bs_fields)bs_fields[a].indexOf("country")>-1?$('select[name="'+bs_fields[a]+'"]').selectpicker("val",""):$('input[name="'+bs_fields[a]+'"]').val(""),"billing_country"==bs_fields[a]&&($('input[name="include_shipping"]').prop("checked",!1),$('input[name="include_shipping"]').change());init_billing_and_shipping_details()}function init_billing_and_shipping_details(){var a,b=$('input[name="include_shipping"]').prop("checked");for(var c in bs_fields)a="",a=bs_fields[c].indexOf("country")>-1?$("#"+bs_fields[c]+" option:selected").data("subtext"):$('input[name="'+bs_fields[c]+'"]').val(),bs_fields[c].indexOf("shipping")>-1&&(b||(a="")),"undefined"==typeof a&&(a=""),a=""!=a?a:"--",$("."+bs_fields[c]).text(a);$("#billing_and_shipping_details").modal("hide")}function record_payment(a){"undefined"!=typeof a&&""!=a&&$("#invoice").load(admin_url+"invoices/record_invoice_payment_ajax/"+a)}function add_item_to_preview(a){$.get(admin_url+"invoice_items/get_item_by_id/"+a,function(a){a.taxname||(a.taxname=""),$('textarea[name="description"]').val(a.description),$('textarea[name="long_description"]').val(a.long_description.replace(/(<|&lt;)br\s*\/*(>|&gt;)/g," ")),$('input[name="quantity"]').val(1),a.taxname&&a.taxrate&&$(".main select.tax").selectpicker("val",a.taxname+"|"+a.taxrate),a.unit&&$("th.qty").attr("unit",a.unit),$('input[name="rate"]').val(a.rate)},"json")}function add_task_to_preview_as_item(a){$.get(admin_url+"tasks/get_billable_task_data/"+a,function(b){b.taxname=$("select.main-tax").selectpicker("val"),$('textarea[name="description"]').val(b.name),$('textarea[name="long_description"]').val(b.description),$('input[name="quantity"]').val(b.total_hours),$('input[name="rate"]').val(b.hourly_rate),$('input[name="task_id"]').val(a)},"json")}function clear_main_values(a){var b=$("table.items tbody").find("tr:last-child").find("select").selectpicker("val");$('textarea[name="description"]').val(""),$('textarea[name="long_description"]').val(""),$('input[name="quantity"]').val(1),$(".main select.tax").selectpicker("val",b),$('input[name="rate"]').val(""),$('input[name="item-search"]').val(""),$(".item-search .dropdown-menu").html(""),$('input[name="task_id"]').val(""),$("th.qty").removeAttr("unit")}function add_item_to_table(a,b,c,d){"undefined"!=typeof a&&"undefined"!=a||(a=get_main_values());var e="",f="",g=$("body").find("tbody .item").length+1;e+='<tr class="sortable item" data-merge-invoice="'+c+'" data-bill-expense="'+d+'">',e+='<td class="dragger">',isNaN(a.qty)&&(a.qty=1),(""==a.rate||isNaN(a.rate))&&(a.rate=0);var h=a.rate*a.qty;h=accounting.formatNumber(h);var i="newitems["+g+"][taxname][]";$("body").append('<div class="dt-loader"></div>');var j=/<br[^>]*>/gi;return get_taxes_dropdown_template(i,a.taxname).done(function(c){e+='<input type="hidden" class="order" name="newitems['+g+'][order]">',e+="</td>",e+='<td class="bold description"><textarea name="newitems['+g+'][description]" class="form-control" rows="5">'+a.description+"</textarea></td>",e+='<td><textarea name="newitems['+g+'][long_description]" class="form-control item_long_description" rows="5">'+a.long_description.replace(j,"\n")+"</textarea></td>",e+='<td><input type="number" min="0" onblur="calculate_total();" onchange="calculate_total();" data-quantity name="newitems['+g+'][qty]" value="'+a.qty+'" class="form-control">',f="",a.unit&&"undefined"!=typeof a.unit||(f=lang_unit,a.unit=""),e+='<input type="text" placeholder="'+f+'" name="newitems['+g+'][unit]" class="form-control input-transparent text-right" value="'+a.unit+'">',e+="</td>",e+='<td class="rate"><input type="text" data-toggle="tooltip" title="'+item_field_not_formated+'" onblur="calculate_total();" onchange="calculate_total();" name="newitems['+g+'][rate]" value="'+a.rate+'" class="form-control"></td>',e+='<td class="taxrate">'+c+"</td>",e+='<td class="amount">'+h+"</td>",e+='<td><a href="#" class="btn btn-danger pull-left" onclick="delete_item(this,'+b+'); return false;"><i class="fa fa-trash"></i></a></td>',e+="</tr>",$.when($("table.items tbody").append(e)).then(calculate_total);var d=$('input[name="task_id"]').val(),i=$('input[name="expense_id"]').val();return""!=d&&"undefined"!=typeof d&&(billed_tasks=d.split(","),$.each(billed_tasks,function(a,b){$("#billed-tasks").append(hidden_input("billed_tasks["+g+"][]",b))})),""!=i&&"undefined"!=typeof i&&(billed_expenses=i.split(","),$.each(billed_expenses,function(a,b){$("#billed-expenses").append(hidden_input("billed_expenses["+g+"][]",b))})),init_selectpicker(),clear_main_values(),reorder_items(),$("body").find(".dt-loader").remove(),$("#item_select").selectpicker("val",""),!0}),!1}function get_taxes_dropdown_template(a,b){jQuery.ajaxSetup({async:!1});var c=$.post(admin_url+"misc/get_taxes_dropdown_template/",{name:a,taxname:b});return jQuery.ajaxSetup({async:!0}),c}function fixHelperTableHelperSortable(a,b){return b.children().each(function(){$(this).width($(this).width())}),b}function init_items_sortable(a){var b=$("body").find(".items tbody");0!=b.length&&b.sortable({helper:fixHelperTableHelperSortable,handle:".dragger",placeholder:"ui-placeholder",itemPath:"> tbody",itemSelector:"tr.sortable",items:"tr.sortable",update:function(){"undefined"==typeof a?reorder_items():save_ei_items_order()},sort:function(a,b){var c=$(a.target);if(!/html|body/i.test(c.offsetParent()[0].tagName)){var d=a.pageY-c.offsetParent().offset().top-b.helper.outerHeight(!0)/2;b.helper.css({top:d+"px"})}}})}function save_ei_items_order(){var a,b=$(".table.invoice-items-preview.items tbody tr,.table.estimate-items-preview.items tbody tr"),c=1,d=[];if($(".table.items").hasClass("invoice-items-preview"))a="invoice";else{if(!$(".table.items").hasClass("estimate-items-preview"))return!1;a="estimate"}$.each(b,function(){d.push([$(this).data("item-id"),c]),$(this).find("td.item_no").html(c),c++}),setTimeout(function(){$.post(admin_url+"misc/update_ei_items_order/"+a,{data:d})},200)}function reorder_items(){var a=$(".table.table-main-invoice-edit tbody tr.item,.table.table-main-estimate-edit tbody tr.item"),b=1;$.each(a,function(){$(this).find("input.order").val(b),b++})}function get_main_values(){var a={};return a.description=$('textarea[name="description"]').val(),a.long_description=$('textarea[name="long_description"]').val(),a.qty=$('input[name="quantity"]').val(),a.taxname=$(".main select.tax").selectpicker("val"),a.rate=$('input[name="rate"]').val(),a.unit=$("th.qty").attr("unit"),a}function calculate_total(){var a,b,c,d,e,f,g={},h=0,i=0,j=1;total_discount_calculated=0,rows=$(".table.table-main-invoice-edit tbody tr.item,.table.table-main-estimate-edit tbody tr.item"),adjustment=$('input[name="adjustment"]').val(),discount_area=$("tr#discount_percent"),discount_percent=$('input[name="discount_percent"]').val(),discount_type=$('select[name="discount_type"]').val(),$(".tax-area").remove(),$.each(rows,function(){j=$(this).find("[data-quantity]").val(),""==j&&(j=1,$(this).find("[data-quantity]").val(1)),e=parseFloat($(this).find("td.rate input").val())*j,$(this).find("td.amount").html(accounting.formatNumber(e)),h+=e,d=$(this),c=$(this).find("select.tax").selectpicker("val"),c&&$.each(c,function(c,h){b=d.find('select.tax [value="'+h+'"]').data("taxrate"),a=e/100*b,g.hasOwnProperty(h)?g[h]=g[h]+=a:0!=b&&(f=h.split("|"),tax_row='<tr class="tax-area"><td>'+f[0]+"("+b+'%)</td><td id="tax_id_'+slugify(h)+'"></td></tr>',$(discount_area).after(tax_row),g[h]=a)})}),""!=discount_percent&&"before_tax"==discount_type&&(total_discount_calculated=h*discount_percent/100),$.each(g,function(a,b){""!=discount_percent&&"before_tax"==discount_type&&(total_tax_calculated=b*discount_percent/100,b-=total_tax_calculated),i+=b,b=accounting.formatNumber(b),$("#tax_id_"+slugify(a)).html(b)}),i+=h,""!=discount_percent&&"after_tax"==discount_type&&(total_discount_calculated=i*discount_percent/100),i-=total_discount_calculated,adjustment=parseFloat(adjustment),isNaN(adjustment)||(i+=adjustment),$(".discount_percent").html("-"+accounting.formatNumber(total_discount_calculated)+hidden_input("discount_percent",discount_percent)+hidden_input("discount_total",total_discount_calculated)),$(".adjustment").html(accounting.formatNumber(adjustment)+hidden_input("adjustment",adjustment.toFixed(decimal_places))),$(".subtotal").html(h=accounting.formatNumber(h)+hidden_input("subtotal",h.toFixed(decimal_places))),$(".total").html(format_money(i)+hidden_input("total",i.toFixed(decimal_places)))}function delete_item(a,b){$(a).parents("tr").addClass("animated fadeOut",function(){setTimeout(function(){$(a).parents("tr").remove(),calculate_total()},50)}),$('input[name="isedit"]').length>0&&$("#removed-items").append(hidden_input("removed_items[]",b))}function format_money(a){return"after"===currency_placement?accounting.formatMoney(a,{format:"%v %s"}):accounting.formatMoney(a)}function init_currency_symbol(){"undefined"!=typeof accounting&&(accounting.settings.currency.symbol=$("body").find('.accounting-template select[name="currency"]').find("option:selected").data("subtext"),calculate_total())}function delete_invoice_attachment(a){var b=confirm(confirm_action_prompt);return 0!=b&&void $.get(admin_url+"invoices/delete_attachment/"+a,function(b){1==b&&($("body").find('[data-attachment-id="'+a+'"]').remove(),init_invoice($("body").find('input[name="_attachment_sale_id"]').val()))}).fail(function(a){alert_float("danger",a.responseText)})}function delete_estimate_attachment(a){var b=confirm(confirm_action_prompt);return 0!=b&&void $.get(admin_url+"estimates/delete_attachment/"+a,function(b){if(1==b){$("body").find('[data-attachment-id="'+a+'"]').remove();var c=$("body").find('input[name="_attachment_sale_id"]').val();$("body").hasClass("estimates-pipeline")?estimate_pipeline_open(c):init_estimate(c)}}).fail(function(a){alert_float("danger",a.responseText)})}function delete_proposal_attachment(a){var b=confirm(confirm_action_prompt);return 0!=b&&void $.get(admin_url+"proposals/delete_attachment/"+a,function(b){if(1==b){var c=$("body").find('input[name="_attachment_sale_id"]').val();$("body").find('[data-attachment-id="'+a+'"]').remove(),$("body").hasClass("proposals-pipeline")?proposal_pipeline_open(c):init_proposal(c)}}).fail(function(a){alert_float("danger",a.responseText)})}function init_invoices_total(a){if(0!=$("#invoices_total").length){var b=$(".invoices-total-inline"),c=$(".invoices-total");if(!$("body").hasClass("invoices_total_manual")||"undefined"!=typeof a||c.hasClass("initialized")){if(b.length>0&&c.hasClass("initialized"))return void b.removeClass("invoices-total-inline");c.addClass("initialized");var d=$("._filters._hidden_inputs").find('input[name^="year"]'),e=[];$.each(d,function(){var a=$(this).val();""!=a&&e.push(a)});var f=$("._filters._hidden_inputs").find('input[name^="sale_agent"]'),g=[];$.each(f,function(){var a=$(this).val();""!=a&&g.push(a)});var h=$("._filters._hidden_inputs").find('input[name^="invoice_payments_by_"]'),i=[];$.each(h,function(){var a=$(this).val();""!=a&&i.push(a)});var j=$("body").find('select[name="total_currency"]').val(),k={currency:j,years:e,agents:g,payment_modes:i,init_total:!0},l=$('input[name="project_id"]').val(),m=$('.customer_profile input[name="userid"]').val();"undefined"!=typeof l?k.project_id=l:"undefined"!=typeof m&&(k.customer_id=m),$.post(admin_url+"invoices/get_invoices_total",k).done(function(a){$("#invoices_total").html(a)})}}}function init_estimates_total(a){if(0!=$("#estimates_total").length&&(!$("body").hasClass("estimates_total_manual")||"undefined"!=typeof a||$(".estimates-total").hasClass("initialized"))){$(".estimates-total").addClass("initialized");var b=$("body").find('select[name="total_currency"]').val(),c=$("._filters._hidden_inputs").find('input[name^="year"]'),d=[];$.each(c,function(){var a=$(this).val();""!=a&&d.push(a)});var e=$("._filters._hidden_inputs").find('input[name^="sale_agent"]'),f=[];$.each(e,function(){var a=$(this).val();""!=a&&f.push(a)});var g="",h="",i=$('.customer_profile input[name="userid"]').val(),j=$('input[name="project_id"]').val();"undefined"!=typeof i?g=i:"undefined"!=typeof j&&(h=j),$.post(admin_url+"estimates/get_estimates_total",{currency:b,init_total:!0,years:d,agents:f,customer_id:g,project_id:h}).done(function(a){$("#estimates_total").html(a)})}}function init_expenses_total(){if(0!=$("#expenses_total").length){var a,b=$('select[name="expenses_total_currency"]').val(),c=$("._filters._hidden_inputs").find('input[name^="year"]'),d=[];$.each(c,function(){a=$(this).val(),""!=a&&d.push(a)});var e=$("._filters._hidden_inputs").find('input[name^="expenses_by_month_"]'),f=[];$.each(e,function(){a=$(this).val(),""!=a&&f.push(a)});var g=$("._filters._hidden_inputs").find('input[name^="expenses_by_category_"]'),h=[];$.each(g,function(){a=$(this).val(),""!=a&&h.push(a)});var i="",j=$('.customer_profile input[name="userid"]').val();"undefined"!=typeof i&&(i=j);var k="",l=$('input[name="project_id"]').val();"undefined"!=typeof k&&(k=l),$.post(admin_url+"expenses/get_expenses_total",{currency:b,init_total:!0,months:f,years:d,categories:h,customer_id:i,project_id:k}).done(function(a){$("#expenses_total").html(a)})}}function validate_invoice_form(a){"undefined"==typeof a&&(a="#invoice-form"),_validate_form($(a),{clientid:"required",date:"required",currency:"required",number:{required:!0}}),$("body").find('input[name="number"]').rules("add",{remote:{url:admin_url+"invoices/validate_invoice_number",type:"post",data:{number:function(){return $('input[name="number"]').val()},isedit:function(){return $('input[name="number"]').data("isedit")},original_number:function(){return $('input[name="number"]').data("original-number")},date:function(){return $('input[name="date"]').val()}}},messages:{remote:invoice_number_exists}})}function validate_estimate_form(a){"undefined"==typeof a&&(a="#estimate-form"),_validate_form($(a),{clientid:"required",date:"required",currency:"required",number:{required:!0}}),$("body").find('input[name="number"]').rules("add",{remote:{url:admin_url+"estimates/validate_estimate_number",type:"post",data:{number:function(){return $('input[name="number"]').val()},isedit:function(){return $('input[name="number"]').data("isedit")},original_number:function(){return $('input[name="number"]').data("original-number")},date:function(){return $('input[name="date"]').val()}}},messages:{remote:estimate_number_exists}})}function estimates_pipeline_sort(a){var b=$('input[name="sort"]');$('input[name="sort_type"]').val(a),"ASC"==b.val()?b.val("DESC"):"DESC"==b.val()?b.val("ASC"):b.val("DESC"),estimate_pipeline()}function proposal_pipeline_sort(a){var b=$('input[name="sort"]');$('input[name="sort_type"]').val(a),"ASC"==b.val()?b.val("DESC"):"DESC"==b.val()?b.val("ASC"):b.val("DESC"),proposals_pipeline()}function estimate_pipeline(){init_kanban("estimates/get_pipeline",estimates_pipeline_update,".pipeline-status",310,360)}function estimates_pipeline_update(a,b){if(b===a.item.parent()[0]){var c={};c.estimateid=$(a.item).data("estimate-id"),c.status=$(a.item.parent()[0]).data("status-id");var d=[],e=$(a.item).parents(".pipeline-status").find("li"),f=1;$.each(e,function(){d.push([$(this).data("estimate-id"),f]),f++}),c.order=d,check_kanban_empty_col("[data-estimate-id]"),$.post(admin_url+"estimates/update_pipeline",c)}}function proposals_pipeline_update(a,b){if(b===a.item.parent()[0]){var c={};c.proposalid=$(a.item).data("proposal-id"),c.status=$(a.item.parent()[0]).data("status-id");var d=[],e=$(a.item).parents(".pipeline-status").find("li"),f=1;$.each(e,function(){d.push([$(this).data("proposal-id"),f]),
f++}),c.order=d,check_kanban_empty_col("[data-proposal-id]"),$.post(admin_url+"proposals/update_pipeline",c)}}function proposals_pipeline(){init_kanban("proposals/get_pipeline",proposals_pipeline_update,".pipeline-status",310,360)}function proposal_pipeline_open(a){""!=a&&$.get(admin_url+"proposals/pipeline_open/"+a,function(a){var b=$(".proposal-pipeline-modal:visible").length;$("#proposal").html(a),0==b?$(".proposal-pipeline-modal").modal({show:!0,backdrop:"static",keyboard:!1}):$("#proposal").find(".modal.proposal-pipeline-modal").addClass("in").css("display","block")})}function estimate_pipeline_open(a){""!=a&&$.get(admin_url+"estimates/pipeline_open/"+a,function(a){var b=$(".estimate-pipeline:visible").length;$("#estimate").html(a),0==b?$(".estimate-pipeline").modal({show:!0,backdrop:"static",keyboard:!1}):$("#estimate").find(".modal.estimate-pipeline").addClass("in").css("display","block")})}function delete_estimate_note(a,b){var c=confirm(confirm_action_prompt);return 0!=c&&void $.get(admin_url+"estimates/delete_note/"+b,function(b){1==b.success&&$(a).parents(".estimate-note").remove()},"json")}function get_estimate_notes(a){$.get(admin_url+"estimates/get_notes/"+a,function(a){$("#estimate_notes_area").html(a)})}function insert_proposal_merge_field(a){var b=$(a).text();tinymce.activeEditor.execCommand("mceInsertContent",!1,b)}function small_table_full_view(){$("#small-table").toggleClass("hide"),$(".small-table-right-col").toggleClass("col-md-12"),$(".small-table-right-col").toggleClass("col-md-7")}function manage_invoice_items(a){var b=$(a).serialize(),c=a.action;return $.post(c,b).done(function(a){if(a=JSON.parse(a),1==a.success){var b=$("#item_select");if($("body").find(".accounting-template").length>0){var c=b.find('[data-group-id="'+a.item.group_id+'"]'),d='<option data-subtext="'+a.item.long_description+'" value="'+a.item.itemid+'">('+accounting.formatNumber(a.item.rate)+") "+a.item.description+"</option>";0==c.length?(d='<optgroup label="'+(null==a.item.group_name?"":a.item.group_name)+'" data-group-id="'+a.item.group_id+'">'+d+"</optgroup>",0==b.find('[data-group-id="0"]').length?b.find("option:first-child").after(d):b.find('[data-group-id="0"]').after(d)):c.prepend(d),b.selectpicker("refresh"),add_item_to_preview(a.item.itemid)}else $(".table-invoice-items").DataTable().ajax.reload();alert_float("success",a.message)}$("#sales_item_modal").modal("hide")}).fail(function(a){alert_float("danger",a.responseText)}),!1}function save_sales_number_settings(a){var b={};b.prefix=$("body").find('input[name="s_prefix"]').val(),""!=b.prefix&&$.post($(a).data("url"),b).done(function(a){a=JSON.parse(a),a.success&&a.message&&(alert_float("success",a.message),$("#prefix").html(b.prefix))})}function do_prefix_year(a){var b;a.indexOf(".")>-1?b=a.split("."):a.indexOf("-")>-1?b=a.split("-"):a.indexOf("/")>-1&&(b=a.split("/")),"undefined"!=typeof b&&$.each(b,function(a,b){4==b.length&&$("#prefix_year").html(b)})}function delete_sale_activity(a){var b=confirm(confirm_action_prompt);return 0!=b&&void $.get(admin_url+"misc/delete_sale_activity/"+a,function(){$("body").find('[data-sale-activity-id="'+a+'"]').remove()})}$.fn.dataTable.ext.errMode="throw";var delay=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}();$.validator.setDefaults({highlight:function(a){$(a).closest(".form-group").addClass("has-error")},unhighlight:function(a){$(a).closest(".form-group").removeClass("has-error")},errorElement:"p",errorClass:"text-danger",errorPlacement:function(a,b){b.parent(".input-group").length||b.parents(".chk").length?b.parents(".chk").length?a.insertAfter(b.parents(".chk")):a.insertAfter(b.parent()):a.insertAfter(b)}});var original_top_search_val,tab_active=get_url_param("tab"),tab_group=get_url_param("group"),side_bar=$("#side-menu"),content_wrapper=$("#wrapper"),setup_menu=$("#setup-menu-wrapper"),menu_href_selector,activity_log_table=$(".table-activity-log"),alerts=$("#alerts"),total_new_post_files=0,newsfeed_posts_page=0,track_load_post_likes=0,track_load_comment_likes=0,post_likes_total_pages=0,comment_likes_total_pages=0,postid=0,available_reminders_table=[".table-reminders",".table-invoices",".table-reminders-leads",".table-invoices",".table-estimates",".table-proposals",".table-expenses"],setup_menu_item=$("#setup-menu-item");Dropzone.options.newsFeedDropzone=!1,Dropzone.options.salesUpload=!1,$(window).on("resize click",function(){setBodySmall(),setTimeout(function(){mainWrapperHeightFix()},300)}),$(function(){$(document).on("focusin",function(a){$(a.target).closest(".mce-window").length&&a.stopImmediatePropagation()}),1!=show_setup_menu_item_only_on_hover||is_mobile()||side_bar.hover(function(){setTimeout(function(){setup_menu_item.css("display","block")},300)},function(){setup_menu_item.css("display","none")}),alerts.length>0&&setTimeout(function(){alerts.slideUp()},4e3),tab_active&&$("body").find('.nav-tabs [href="#'+tab_active+'"]').click(),tab_group&&($("body").find(".nav-tabs li").not('[role="presentation"]').removeClass("active"),$("body").find('.nav-tabs [data-group="'+tab_group+'"]').parents("li").addClass("active")),jQuery.datetimepicker.setLocale(locale),moment.locale(locale),moment().tz(timezone).format(),init_editor(),$("body").on("click","#started-timers-top",function(a){a.stopPropagation()}),init_tags_inputs(),init_color_pickers(),initDataTableOffline(),$("body").on("change",".onoffswitch input",function(a,b){var c=$(this).data("switch-url");c&&switch_field(this)}),custom_fields_hyperlink(),init_lightbox(),init_progress_bars(),init_datepicker(),init_selectpicker(),setBodySmall(),mainWrapperHeightFix(),init_form_reminder(),$("body").on("click",".delete-reminder",function(){var a=confirm(confirm_action_prompt);return 0!=a&&($.get($(this).attr("href"),function(a){alert_float(a.alert_type,a.message),$.each(available_reminders_table,function(a,b){$.fn.DataTable.isDataTable(b)&&$("body").find(b).DataTable().ajax.reload()})},"json"),!1)}),$("body").on("click","table.dataTable tbody .tags-labels .label-tag",function(){$(this).parents("table").DataTable().search($(this).find(".tag").text()).draw(),$("div.dataTables_filter input").focus()}),$("[data-can-view-own],[data-can-view]").on("change",function(){var a=$(this).attr("data-can-view-own");view_chk_selector=$(this).parents("tr").find("td input["+("undefined"!=typeof a&&a!==!1?"data-can-view":"data-can-view-own")+"]"),view_chk_selector.prop("checked",!1),1==$(this).prop("checked")?view_chk_selector.prop("disabled",!0):view_chk_selector.prop("disabled",!1)}),"undefined"!=typeof taskid&&""!==taskid&&init_task_modal(taskid),$("body").on("change",'input[name="checklist-box"]',function(){var a=$(this).prop("checked");1==a?val=1:val=0;var b=$(this).parents(".checklist").data("checklist-id");$.get(admin_url+"tasks/checkbox_action/"+b+"/"+val),recalculate_checklist_items_progress()}),$("body").on("keyup paste click","textarea[name='checklist-description']",function(a){do_task_checklist_items_height($(this))}),$("body").on("click",".task-single-delete-timesheet",function(a){a.preventDefault();var b=confirm(confirm_action_prompt);if(0==b)return!1;var c=$(this).data("task-id");$.get($(this).attr("href"),function(){init_task_modal(c),setTimeout(function(){reload_tasks_tables()},20)})}),$("body").on("click",".task-single-add-timesheet",function(a){a.preventDefault();var b=$("body").find('.task-modal-single input[name="timesheet_start_time"]').val(),c=$("body").find('.task-modal-single input[name="timesheet_end_time"]').val();if(""!=b&&""!=c){var d={};d.start_time=b,d.end_time=c,d.timesheet_task_id=$(this).data("task-id"),d.timesheet_staff_id=$("body").find('.task-modal-single select[name="single_timesheet_staff_id"]').val(),$.post(admin_url+"tasks/log_time",d).done(function(a){a=JSON.parse(a),1==a.success?(init_task_modal(d.timesheet_task_id),alert_float("success",a.message),setTimeout(function(){reload_tasks_tables()},20)):alert_float("warning",a.message)})}}),$("body").on("click",".copy_task_action",function(){var a={};return a.copy_from=$(this).data("task-copy-from"),a.copy_task_assignees=$("body").find("#copy_task_assignees").prop("checked"),a.copy_task_followers=$("body").find("#copy_task_followers").prop("checked"),a.copy_task_checklist_items=$("body").find("#copy_task_checklist_items").prop("checked"),a.copy_task_attachments=$("body").find("#copy_task_attachments").prop("checked"),$.post(admin_url+"tasks/copy",a).done(function(a){a=JSON.parse(a),1==a.success&&(init_task_modal(a.new_task_id),reload_tasks_tables()),alert_float(a.alert_type,a.message)}),!1}),$("body").on("click",".new-task-to-milestone",function(a){a.preventDefault();var b=$(this).parents(".milestone-column").data("milestone-id");new_task(admin_url+"tasks/task?rel_type=project&rel_id="+project_id+"&milestone_id="+b)}),$("body").on("shown.bs.modal","#_task_modal",function(){0==$('input[name="task_is_edit"]').length&&(tinyMCE.execCommand("mceAddControl",!1,"tinymce-task"),$("body").find('#_task_modal input[name="name"]').focus())}),$("body").on("hidden.bs.modal","#_task_modal",function(){tinyMCE.remove(".tinymce-task"),"undefined"!=typeof _ticket_message&&(_ticket_message=void 0),$("body #_task_modal .datepicker").datetimepicker("destroy")}),$("body").on("shown.bs.modal",".task-modal-single",function(){fix_task_modal_left_col_height(),$(document).off("focusin.modal")}),$("body").on("hidden.bs.modal",".task-modal-single",function(){"undefined"!=typeof taskAttachmentDropzone&&taskAttachmentDropzone.destroy()}),$("body").on("hide.bs.modal",".task-modal-single",function(){if(1==$("#lightbox").is(":visible"))return!1}),$("body").on("blur",".task-modal-single ul.tagit li.tagit-new input",function(){setTimeout(function(){task_single_update_tags()},100)}),$("body").on("click",".close-task-stats",function(){$("#task-tracking-stats-modal").modal("hide")}),$("body").on("blur",'textarea[name="checklist-description"]',function(){var a=$(this).val(),b=$(this).parents(".checklist").data("checklist-id");$.post(admin_url+"tasks/update_checklist_item",{description:a,listid:b})}),$("body").on("change",'select[name="select-assignees"]',function(){$("body").append('<div class="dt-loader"></div>');var a={};a.assignee=$('select[name="select-assignees"]').val(),""!=a.assignee&&(a.taskid=$(this).attr("data-task-id"),$.post(admin_url+"tasks/add_task_assignees",a).done(function(b){$("body").find(".dt-loader").remove(),b=JSON.parse(b),reload_tasks_tables(),init_task_modal(a.taskid)}))}),$("body").on("change",'select[name="select-followers"]',function(){var a={};a.follower=$('select[name="select-followers"]').val(),""!=a.follower&&(a.taskid=$(this).attr("data-task-id"),$("body").append('<div class="dt-loader"></div>'),$.post(admin_url+"tasks/add_task_followers",a).done(function(b){b=JSON.parse(b),$("body").find(".dt-loader").remove(),init_task_modal(a.taskid)}))}),$("body").on("show.bs.modal","#task-tracking-stats-modal",function(){var a=$("body").find("#task-tracking-stats-chart");setTimeout(function(){"undefined"!=typeof task_track_chart&&task_track_chart.destroy(),task_track_chart=new Chart(a,{type:"line",data:task_tracking_stats_data,options:{legend:{display:!1},responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!0,mode:"single",callbacks:{label:function(a,b){return decimalToHM(a.yLabel)}}},scales:{yAxes:[{ticks:{beginAtZero:!0,min:0,userCallback:function(a,b,c){return decimalToHM(a)}}}]}}})},800)}),$("body").on("shown.bs.modal","#sync_data_proposal_data",function(){"lead"==$("#sync_data_proposal_data").data("rel-type")&&$(".lead-modal .modal-content").eq(0).css("height",$("#sync_data_proposal_data .modal-content").height()+80+"px").css("overflow-x","hidden")}),$("body").on("hidden.bs.modal","#sync_data_proposal_data",function(){"lead"==$("#sync_data_proposal_data").data("rel-type")&&$(".lead-modal .modal-content").prop("style","")}),"undefined"!=typeof c_leadid&&""!=c_leadid&&init_lead(c_leadid),$("body").on("click",".leads-kan-ban .cpicker",function(){var a=$(this).data("color"),b=$(this).parents(".panel-heading-bg").data("status-id");$.post(admin_url+"leads/change_status_color",{color:a,status_id:b})}),$("body").on("click","[lead-edit]",function(a){a.preventDefault(),$("body .lead-view").toggleClass("hide"),$("body .lead-edit").toggleClass("hide")}),$("body").on("click",".new-lead-from-status",function(a){a.preventDefault();var b=$(this).parents(".kan-ban-col").data("col-status-id");init_lead_modal_data(void 0,admin_url+"leads/lead?status_id="+b)}),$("body").on("change","input.include_leads_custom_fields",function(){var a=$(this).val(),b=$(this).data("field-id");2==a?$("#merge_db_field_"+b).removeClass("hide"):$("#merge_db_field_"+b).addClass("hide"),3==a?$("#merge_db_contact_field_"+b).removeClass("hide"):$("#merge_db_contact_field_"+b).addClass("hide")}),$('input[name="notify_type"]').on("change",function(){var a=$(this).val();"specific_staff"==a?($("#specific_staff_notify").removeClass("hide"),$("#role_notify").addClass("hide")):"roles"==a?($("#specific_staff_notify").addClass("hide"),$("#role_notify").removeClass("hide")):"assigned"==a&&($("#specific_staff_notify").addClass("hide"),$("#role_notify").addClass("hide"))}),$("body").on("shown.bs.modal",".lead-modal",function(a){0==$("body").find('.lead-modal input[name="leadid"]').length&&$("body").find('.lead-modal input[name="name"]').focus()}),$(".lead-modal").on("hidden.bs.modal",function(a){$(this).data("bs.modal",null),$("#lead_reminder_modal").html(""),$(".lead-modal").is(":visible")||history.pushState("",document.title,window.location.pathname+window.location.search),$("body .lead-modal .datetimepicker").datetimepicker("destroy"),"undefined"!=typeof leadAttachmentsDropzone&&leadAttachmentsDropzone.destroy()}),$("body").on("hidden.bs.modal","#convert_lead_to_client_modal",function(a){$(this).data("bs.modal",null)}),$("body").on("click",'.lead-modal a[data-toggle="tab"]',function(){"#tab_lead_profile"==this.hash||"#attachments"==this.hash||"#lead_notes"==this.hash?window.location.hash=this.hash:history.pushState("",document.title,window.location.pathname+window.location.search)}),$("body").on("submit",".lead-modal #lead-notes",function(){var a=$(this),b=$(a).serialize();return $.post(a.attr("action"),b).done(function(a){init_lead_modal_data(a)}),!1});var a={custom_view:"[name='custom_view']",assigned:"[name='view_assigned']",status:"[name='view_status']",source:"[name='view_source']"},b=$(".table-leads").find("th"),c=b.length-1;initDataTable(".table-leads",admin_url+"leads?table_leads=true",[c,0],[c,0],a,[10,"DESC"]),$.each(a,function(a,b){$("select"+b).on("change",function(){$(".table-leads").DataTable().ajax.reload()})}),$("body").on("change",'input[name="contacted_today"]',function(){var a=$(this).prop("checked");0==a?$(".lead-select-date-contacted").removeClass("hide"):$(".lead-select-date-contacted").addClass("hide")}),$("body").on("change",'input[name="contacted_indicator"]',function(){var a=$(this).val();"yes"==a?$(".lead-select-date-contacted").removeClass("hide"):$(".lead-select-date-contacted").addClass("hide")}),$("body").on("click","table.dataTable tbody td:first-child",function(){var a=$(this).parents("tr"),b=$(this).parents("table").DataTable().row(a);if(b.child.isShown()){var c=$(a).next().find("input.onoffswitch-checkbox");if(c.length>0){var d=Math.random().toString(16).slice(2);c.attr("id",d),c.next().attr("for",d)}}}),$("body").on("click","[data-loading-text]",function(){var a=$(this).data("form");null!=a?$(a).valid()&&$(this).button("loading"):$(this).button("loading")}),$("body").on("click",".close-reminder-modal",function(){$(".reminder-modal-"+$(this).data("rel-type")+"-"+$(this).data("rel-id")).modal("hide")}),$("body").on("shown.bs.tab",'a[data-toggle="tab"]',function(a){$($.fn.dataTable.tables(!0)).DataTable().responsive.recalc()}),$("form").not("#single-ticket-form,#calendar-event-form,#proposal-form").areYouSure();var d=side_bar.find("li > a");if($.each(d,function(a,b){var c=$(b).attr("href");location==c&&(menu_href_selector='a[href="'+c+'"]',side_bar.find(menu_href_selector).parents("li").not(".quick-links").addClass("active"),side_bar.find(menu_href_selector).prop("aria-expanded",!0),side_bar.find(menu_href_selector).parents("ul.nav-second-level").prop("aria-expanded",!0),side_bar.find(menu_href_selector).parents("li").find("a:first-child").prop("aria-expanded",!0))}),$("body").on("click",".editor-add-content-notice",function(){$(this).remove(),tinymce.triggerSave()}),setup_menu.hasClass("display-block")){var e=setup_menu.find("li > a");$.each(e,function(a,b){var c=$(b).attr("href");location==c&&(menu_href_selector='a[href="'+c+'"]',setup_menu.find(menu_href_selector).parents("li").addClass("active"),setup_menu.find(menu_href_selector).prev("active"),setup_menu.find(menu_href_selector).parents("ul.nav-second-level").prop("aria-expanded",!0),setup_menu.find(menu_href_selector).parents("li").find("a:first-child").prop("aria-expanded",!0))})}if(side_bar.metisMenu(),setup_menu.metisMenu(),$(".hide-menu").click(function(a){a.preventDefault(),$(window).width()<769?$("body").toggleClass("show-sidebar"):($("#setup-menu-wrapper").hasClass("display-block")&&$(".close-customizer").click(),$("body").toggleClass("hide-sidebar"))}),is_mobile()&&content_wrapper.on("click",function(){$("body").hasClass("show-sidebar")&&$("body").removeClass("show-sidebar"),setup_menu.hasClass("display-block")&&$(".close-customizer").click()}),$("#search_input").on("keyup paste",function(){var a=$(this).val().trim(),b=$("#search_results"),c=$("#top_search_button button");if(!(a.length<2)){if(""==a)return content_wrapper.unhighlight(),b.html(""),original_top_search_val="",c.html('<i class="fa fa-search"></i>'),void c.removeClass("search_remove");c.html('<i class="fa fa-remove"></i>'),c.addClass("search_remove"),delay(function(){a!=original_top_search_val&&$.post(admin_url+"misc/search",{q:a}).done(function(c){content_wrapper.unhighlight(),b.html(c),content_wrapper.highlight(a),original_top_search_val=a})},700)}}),$(".bulk_actions").on("change",'input[name="mass_delete"]',function(){1==$(this).prop("checked")&&$("#bulk_change").find("select").selectpicker("val",""),$("#bulk_change").toggleClass("hide"),$(".mass_delete_separator").toggleClass("hide")}),$("body").on("hidden.bs.modal","#__todo",function(){$("#__todo").find('input[name="todoid"]').val(""),$("#__todo").find('textarea[name="description"]').val(""),$("#__todo .add-title").addClass("hide"),$("#__todo .edit-title").addClass("hide")}),$("body").on("shown.bs.modal","#__todo",function(){$("#__todo").find('textarea[name="description"]').focus(),""!=$("#__todo").find('input[name="todoid"]').val()?($("#__todo .add-title").addClass("hide"),$("#__todo .edit-title").removeClass("hide")):($("#__todo .add-title").removeClass("hide"),$("#__todo .edit-title").addClass("hide"))}),$("#top_search_button button").on("click",function(){$("#search_input").focus(),$(this).hasClass("search_remove")&&($(this).html('<i class="fa fa-search"></i>'),$(this).removeClass("search_remove"),original_top_search_val="",$("#search_results").html(""),$("#search_input").val(""))}),$("body").click(function(a){$(a.target).parents("#top_search_dropdown").hasClass("search-results")||$("#top_search_dropdown").remove()}),$("body").tooltip({selector:'[data-toggle="tooltip"]'}),$("body").popover({selector:'[data-toggle="popover"]'}),$("body").on("click",function(a){$('[data-toggle="popover"],.manual-popover').each(function(){$(this).is(a.target)||0!==$(this).has(a.target).length||0!==$(".popover").has(a.target).length||$(this).popover("hide")})}),$("body").on("click","._filter_data ul.dropdown-menu li a",function(a){a.stopPropagation(),a.preventDefault()}),$("body").on("click",function(){$(".tooltip").remove()}),$("body").on("click","._delete",function(a){var b=confirm(confirm_action_prompt);return 1==b}),$("body").on("shown.bs.modal",".modal",function(){$("body").addClass("modal-open"),$("body").find("#started-timers-top").parents("li").removeClass("open")}),$("body").on("hidden.bs.modal",".modal",function(a){$(".modal:visible").length&&$(document.body).addClass("modal-open"),$(this).data("bs.modal",null)}),activity_log_table.length>0&&$(".datepicker.activity-log-date").on("change",function(){activity_log_table.DataTable().column($(this).attr("data-column")).search($(this).val()).draw()}),$("body").on("change",'[name="repeat_every"]',function(){var a=$(this).val();"custom"==a?$(".recurring_custom").removeClass("hide"):$(".recurring_custom").addClass("hide"),""!=a?$("body").find("#recurring_ends_on").removeClass("hide"):($("body").find("#recurring_ends_on").addClass("hide"),$("body").find("#recurring_ends_on input").val(""))}),$('select[name="range"]').on("change",function(){"period"==$(this).val()?$(".period").removeClass("hide"):($(".period").addClass("hide"),$(".period").find("input").val(""))}),$("body").on("change","#mass_select_all",function(){var a,b,c;a=$(this).data("to-table"),b=$(".table-"+a).find("tbody tr"),c=$(this).prop("checked"),$.each(b,function(){$($(this).find("td").eq(0)).find("input").prop("checked",c)})}),$("body").on("show.bs.modal",".modal.email-template",function(){init_editor($(this).data("editor-id"),{urlconverter_callback:"merge_field_format_url"})}),$("body").on("hidden.bs.modal",".modal.email-template",function(){tinymce.remove($(this).data("editor-id"))}),$(".close-customizer").on("click",function(a){a.preventDefault(),setup_menu.addClass("true"==isRTL?"fadeOutRight":"fadeOutLeft"),$.get(admin_url+"misc/set_setup_menu_closed")}),$(".open-customizer").on("click",function(a){a.preventDefault(),setup_menu.hasClass("true"==isRTL?"fadeOutRight":"fadeOutLeft")&&setup_menu.removeClass("true"==isRTL?"fadeOutRight":"fadeOutLeft"),setup_menu.addClass("true"==isRTL?"fadeInRight":"fadeInLeft"),setup_menu.addClass("display-block"),$.get(admin_url+"misc/set_setup_menu_open"),mainWrapperHeightFix()}),$("body").on("click",".cpicker",function(){var a=$(this).data("color");$(this).parents(".cpicker-wrapper").find(".cpicker-big").removeClass("cpicker-big").addClass("cpicker-small"),$(this).removeClass("cpicker-small","fast").addClass("cpicker-big","fast"),$(this).hasClass("kanban-cpicker")?($(this).parents(".panel-heading-bg").css("background",a),$(this).parents(".panel-heading-bg").css("border","1px solid "+a)):$(this).hasClass("calendar-cpicker")&&$("body").find('._event input[name="color"]').val(a)}),$("body").on("click",".notification_link",function(){var a,b=$(this).data("link");a=b.split("#"),a[1]||(window.location.href=b)}),$("body").on("click",".notifications a,.notification_link",function(a){var b,c;if(b=$(this).hasClass("notification_link")?$(this).data("link"):a.currentTarget.href,b=b.split("#"),b[1]&&b[1].indexOf("=")>-1){a.preventDefault();var c=b[1].split("=")[1];b[1].indexOf("postid")>-1?(postid=c,$(".open_newsfeed").click()):b[1].indexOf("taskid")>-1?init_task_modal(c):b[1].indexOf("leadid")>-1&&init_lead(c)}}),$(".notifications-icon,.notifications-wrapper").on("click",function(){clearInterval(autocheck_notifications_timer_id),$.post(admin_url+"misc/set_notifications_read").done(function(a){a=JSON.parse(a),1==a.success&&($(".icon-notifications").addClass("hide"),setTimeout(function(){$(".notification-box.unread").removeClass("unread")},1e3))})}),0!=auto_check_for_new_notifications){var f=$("#header li.notifications-wrapper");autocheck_notifications_timer_id=setInterval(function(){$.get(admin_url+"misc/notifications_check",function(a){f.html(a)})},1e3*auto_check_for_new_notifications)}if(init_table_tickets(),init_table_announcements(),init_table_staff_projects(),initDataTable(".table-activity-log",window.location.href,"undefined","undefined","undefined",[1,"DESC"]),$(".table-invoices").length>0||$(".table-estimates").length>0){var g={},h=$("._hidden_inputs._filters input");$.each(h,function(){g[$(this).attr("name")]='[name="'+$(this).attr("name")+'"]'}),_table_api=initDataTable(".table-invoices",admin_url+"invoices/list_invoices","undefined","undefined",g,[[3,"DESC"],[0,"DESC"]]),_table_api&&_table_api.column(3).visible(!1,!1).columns.adjust(),_table_api=initDataTable(".table-estimates",admin_url+"estimates/list_estimates","undefined","undefined",g,[[3,"DESC"],[0,"DESC"]]),_table_api&&_table_api.column(3).visible(!1,!1).columns.adjust()}var i,j={};i=$("._hidden_inputs._filters._tasks_filters input"),$.each(i,function(){j[$(this).attr("name")]='[name="'+$(this).attr("name")+'"]'}),_tns=[$(".table-tasks").find("th").length-1];var k=2,l=admin_url+"tasks";$("body").hasClass("tasks_page")&&(_tns.push(0),k=3,l+="?bulk_actions=true"),_table_api=initDataTable(".table-tasks",l,_tns,_tns,j,[k,"ASC"]),_table_api&&$("body").hasClass("home")&&_table_api.column(4).visible(!1,!1).column(6).visible(!1,!1).column(5).visible(!1,!1).columns.adjust(),$("#send_file").on("show.bs.modal",function(a){$("#send_file").find('input[name="filetype"]').val($($(a.relatedTarget)).data("filetype")),$("#send_file").find('input[name="file_path"]').val($($(a.relatedTarget)).data("path")),$("#send_file").find('input[name="file_name"]').val($($(a.relatedTarget)).data("file-name")),$('input[name="email"]').length>0&&$("#send_file").find('input[name="send_file_email"]').val($('input[name="email"]').val())}),$("body").on("change",'input[name="send_set_password_email"]',function(){$("body").find(".client_password_set_wrapper").toggleClass("hide")}),$("body").on("change",'.todo input[type="checkbox"]',function(){var a=$(this).prop("checked")===!0?1:0;window.location.href=admin_url+"todo/change_todo_status/"+$(this).val()+"/"+a});var m=$(".todos-sortable");if(m.length>0&&(m=m.sortable({connectWith:".todo",items:"li",handle:".dragger",appendTo:"body",update:function(a,b){this===b.item.parent()[0]&&update_todo_items()}})),$("body").on("click",".open_newsfeed,.close_newsfeed",function(a){if(a.preventDefault(),"undefined"==typeof $(this).data("close")){var b=admin_url+"newsfeed/get_data";$.get(b,function(a){$("#newsfeed").html(a),load_newsfeed(postid),init_newsfeed_form(),init_selectpicker(),include_lightbox(),init_lightbox()})}else $(this).data("close")===!0&&(newsFeedDropzone.destroy(),$("#newsfeed").html(""),total_new_post_files=0,newsfeed_posts_page=0,track_load_post_likes=0,track_load_comment_likes=0,postid=void 0);$("#newsfeed").toggleClass("hide"),$("body").toggleClass("noscroll")}),$("[data-newsfeed-auto]").length>0&&$(".open_newsfeed").click(),$("body").on("keyup",".comment-input input",function(a){13==a.keyCode&&add_comment(this)}),$("#modal_post_likes").on("show.bs.modal",function(a){track_load_post_likes=0,$("#modal_post_likes_wrapper").empty(),$(".likes_modal .modal-footer").removeClass("hide");var b=$(a.relatedTarget),c=$(b).data("postid");post_likes_total_pages=$(b).data("total-pages"),$(".load_more_post_likes").attr("data-postid",c),load_post_likes(c)}),$("#modal_post_comment_likes").on("show.bs.modal",function(a){$("#modal_comment_likes_wrapper").empty(),track_load_comment_likes=0,$(".likes_modal .modal-footer").removeClass("hide");var b=$(a.relatedTarget),c=$(b).data("commentid");comment_likes_total_pages=$(b).data("total-pages"),$(".load_more_post_comment_likes").attr("data-commentid",c),load_comment_likes(c)}),$(".load_more_post_likes").on("click",function(a){a.preventDefault(),load_post_likes($(this).data("postid"))}),$(".load_more_post_comment_likes").on("click",function(a){a.preventDefault(),load_comment_likes($(this).data("commentid"))}),$(".add-attachments").on("click",function(a){a.preventDefault(),$("#post-attachments").toggleClass("hide")}),$("body").on("change","#post-visibility",function(){var a=$(this).val();null!=a&&a.indexOf("all")>-1&&a.length>1&&(a.splice(0,1),$(this).selectpicker("val",a))}),init_invoices_total(),init_expenses_total(),init_estimates_total(),init_items_sortable(),$("body").hasClass("estimates-pipeline")){var n=$('input[name="estimateid"]').val();estimate_pipeline_open(n)}if($("body").hasClass("proposals-pipeline")){var o=$('input[name="proposalid"]').val();proposal_pipeline_open(o)}$("body").on("submit","._transaction_form",function(){return calculate_total(),reorder_items(),$('select[name="currency"]').prop("disabled",!1),$('select[name="project_id"]').prop("disabled",!1),!0}),$("body").on("click",".invoice-form-submit",function(){var a=$(".invoice-form");a.valid()&&($(this).hasClass("save-as-draft")?a.find(".additional").html(hidden_input("save_as_draft","true")):a.find(".additional").html(""),a.submit())}),$("body").on("change",'[name="recurring"]',function(){var a=$(this).val();0!=a?("custom"==a?$(".recurring_custom").removeClass("hide"):$(".recurring_custom").addClass("hide"),$("body").find("#recurring_ends_on").removeClass("hide")):($("body").find("#recurring_ends_on").addClass("hide"),$("body").find("#recurring_ends_on input").val(""),$(".recurring_custom").addClass("hide"))}),$("body").on("submit","#estimate-notes",function(){var a=$("#estimate-notes");if(""!=a.find('textarea[name="description"]').val()){var b=$(this),c=$(b).serialize();return $.post(b.attr("action"),c).done(function(b){get_estimate_notes(b),a.find('textarea[name="description"]').val("")}),!1}}),$("body").on("change",'input[name="show_quantity_as"]',function(){$("body").find("th.qty").html($(this).data("text"))}),$("body").on("change",'div.estimate input[name="date"]',function(){do_prefix_year($(this).val())}),$("body").on("change",'div.invoice input[name="date"],div.estimate input[name="date"]',function(){var a=$(this).val();if(do_prefix_year(a),!($('input[name="isedit"]').length>0)){var b="duedate",c=admin_url+"invoices/get_due_date";$("body").find("div.estimate").length>0&&(c=admin_url+"estimates/get_due_date",b="expirydate"),""!=a?$.post(c,{date:a}).done(function(a){$('input[name="'+b+'"]').val(a)}):$('input[name="'+b+'"]').val("")}}),$("#sales_attach_file").on("hidden.bs.modal",function(a){$("#sales_uploaded_files_preview").empty(),$(".dz-file-preview").empty()}),"undefined"!=typeof Dropbox&&$("#dropbox-chooser-sales").length>0&&document.getElementById("dropbox-chooser-sales").appendChild(Dropbox.createChooseButton({success:function(a){var b={};b.rel_id=$("body").find('input[name="_attachment_sale_id"]').val(),b.type=$("body").find('input[name="_attachment_sale_type"]').val(),b.files=a,b.external="dropbox",$.post(admin_url+"misc/add_sales_external_attachment",b).done(function(){"invoice"==b.type?init_invoice(b.rel_id):"estimate"==b.type?$("body").hasClass("estimates-pipeline")?estimate_pipeline_open(b.rel_id):init_estimate(b.rel_id):"proposal"==b.type&&($("body").hasClass("proposals-pipeline")?proposal_pipeline_open(b.rel_id):init_proposal(b.rel_id)),$("#sales_attach_file").modal("hide")})},linkType:"preview",extensions:allowed_files.split(",")})),$("#sales-upload").length>0&&new Dropzone("#sales-upload",{createImageThumbnails:!1,dictFileTooBig:file_exceds_maxfile_size_in_form,dictDefaultMessage:drop_files_here_to_upload,dictFallbackMessage:browser_not_support_drag_and_drop,dictRemoveFile:remove_file,sending:function(a,b,c){c.append("rel_id",$("body").find('input[name="_attachment_sale_id"]').val()),c.append("type",$("body").find('input[name="_attachment_sale_type"]').val())},complete:function(a){this.removeFile(a)},success:function(a,b){b=JSON.parse(b);var c,d,e=$("body").find('input[name="_attachment_sale_type"]').val();c="download/file/sales_attachment/",d="delete_"+e+"_attachment","invoice"==e?init_invoice(b.rel_id):"estimate"==e?$("body").hasClass("estimates-pipeline")?estimate_pipeline_open(b.rel_id):init_estimate(b.rel_id):"proposal"==e&&($("body").hasClass("proposals-pipeline")?proposal_pipeline_open(b.rel_id):init_proposal(b.rel_id));var f="";1==b.success&&(f+='<div class="display-block" data-attachment-id="'+b.attachment_id+'">',f+='<div class="col-md-10">',f+='<div class="pull-left"><i class="attachment-icon-preview fa fa-file-o"></i></div>',f+='<a href="'+site_url+c+b.key+'" target="_blank">'+b.file_name+"</a>",f+='<p class="text-muted">'+b.filetype+"</p>",f+="</div>",f+='<div class="col-md-2 text-right">',
f+='<a href="#" class="text-danger" onclick="'+d+"("+b.attachment_id+'); return false;"><i class="fa fa-times"></i></a>',f+="</div>",f+='<div class="clearfix"></div><hr/>',f+="</div>",$("#sales_uploaded_files_preview").append(f))},maxFilesize:max_php_ini_upload_size.replace(/\D/g,""),acceptedFiles:allowed_files,error:function(a,b){alert_float("danger",b)}}),$("#invoice_attach").on("hidden.bs.modal",function(a){$(".dz-preview").remove(),$(".invoice-attach-dropzone-preview").remove()}),$("body").on("show.bs.modal","#sales_item_modal",function(a){_validate_form($("#invoice_item_form"),{description:"required",rate:{required:!0}},manage_invoice_items),$(".affect-warning").addClass("hide");var b=$(a.relatedTarget),c=b.data("id");$("#sales_item_modal input").val(""),$("#sales_item_modal textarea").val(""),$("#sales_item_modal #group_id").selectpicker("val",""),$('select[name="tax"]').selectpicker("deselectAll"),$("#sales_item_modal .add-title").removeClass("hide"),$("#sales_item_modal .edit-title").addClass("hide"),"undefined"!=typeof c&&($(".affect-warning").removeClass("hide"),$('input[name="itemid"]').val(c),$("#sales_item_modal .add-title").addClass("hide"),$("#sales_item_modal .edit-title").removeClass("hide"),$('#sales_item_modal input[name="description"]').val($(b).parents("tr").find("td").eq(0).text()),$('#sales_item_modal input[name="rate"]').val($(b).parents("tr").find("td").eq(2).text()),$('#sales_item_modal input[name="unit"]').val($(b).parents("tr").find("td").eq(4).text()),$("#sales_item_modal textarea").val($(b).parents("tr").find("td").eq(1).text()),$("#sales_item_modal #group_id").selectpicker("val",b.attr("data-group-id")),$('select[name="tax"]').selectpicker("val",$(b).parents("tr").find("td").eq(3).find("span").data("taxid")))}),$("body").on("hidden.bs.modal","#sales_item_modal",function(a){$("#item_select").selectpicker("val","")}),$("body").on("click",".invoice-send-to-client",function(a){a.preventDefault(),$("#invoice_send_to_client_modal").modal("show")}),$("body").on("click",".estimate-send-to-client",function(a){a.preventDefault(),$("#estimate_send_to_client_modal").modal("show")}),$("body").on("click",".close-send-template-modal",function(){$("#estimate_send_to_client_modal").modal("hide"),$("#proposal_send_to_customer").modal("hide")}),$("body").on("change","#include_shipping",function(){1==$(this).prop("checked")?$("#shipping_details").removeClass("hide"):$("#shipping_details").addClass("hide")}),$("body").on("click",".save-shipping-billing",function(a){init_billing_and_shipping_details()}),$("body").on("change",'select[name="currency"]',function(){init_currency_symbol()}),$("body").on("change","select.tax",function(){var a=$(this).val();null!=a&&a.indexOf("")>-1&&a.length>1&&(a.splice(0,1),$(this).selectpicker("val",a))}),$("body").on("change",'input[name="adjustment"],select.tax',function(){calculate_total()}),$("body").on("change",'select[name="discount_type"]',function(){""==$(this).val()&&$('input[name="discount_percent"]').val(0),calculate_total()}),$("body").on("change",'input[name="discount_percent"]',function(){return""==$('select[name="discount_type"]').val()&&0!=$(this).val()?(alert("Select discount type"),$("html,body").animate({scrollTop:0},"slow"),$("#wrapper").highlight($('label[for="discount_type"]').text()),setTimeout(function(){$("#wrapper").unhighlight()},3e3),!1):void(1==$(this).valid()&&calculate_total())}),$("body").on("change",'select[name="item_select"]',function(){var a=$(this).selectpicker("val");""!=a&&"newitem"!==a?add_item_to_preview(a):"newitem"==a&&$("#sales_item_modal").modal("show")}),$("body").on("change",'select[name="task_select"]',function(){var a=$(this).selectpicker("val");""!=a&&add_task_to_preview_as_item(a)}),$("body").on("change",'select[name="paymentmode"]',function(){$.isNumeric($(this).val())?$(".do_not_redirect").addClass("hide"):$(".do_not_redirect").removeClass("hide")}),$("body").on("change",'.f_client_id select[name="clientid"]',function(){var a=$(this).val(),b=$('select[name="project_id"]');if(b.empty(),clear_billing_and_shipping_details(),""==a)return $("#merge").empty(),$("#expenses_to_bill").empty(),b.selectpicker("refresh"),$(".projects-wrapper").addClass("hide"),!1;var c=$("body").find('input[name="merge_current_invoice"]').val();$.get(admin_url+"invoices/client_change_data/"+a+"/"+c,function(a){$("#merge").html(a.merge_info),$("#expenses_to_bill").html(a.expenses_bill_info),""!=a.merge_info||""!=a.expenses_bill_info?$("#invoice_top_info").removeClass("hide"):$("#invoice_top_info").addClass("hide");for(var c in bs_fields)bs_fields[c].indexOf("billing")>-1&&(bs_fields[c].indexOf("country")>-1?$('select[name="'+bs_fields[c]+'"]').selectpicker("val",a.billing_shipping[0][bs_fields[c]]):$('input[name="'+bs_fields[c]+'"]').val(a.billing_shipping[0][bs_fields[c]]));empty(a.billing_shipping[0].shipping_street)||($('input[name="include_shipping"]').prop("checked",!0),$('input[name="include_shipping"]').change());for(var c in bs_fields)bs_fields[c].indexOf("shipping")>-1&&(bs_fields[c].indexOf("country")>-1?$('select[name="'+bs_fields[c]+'"]').selectpicker("val",a.billing_shipping[0][bs_fields[c]]):$('input[name="'+bs_fields[c]+'"]').val(a.billing_shipping[0][bs_fields[c]]));init_billing_and_shipping_details();var d=a.client_currency,e=$("body").find('.accounting-template select[name="currency"]');d=parseInt(d),0!=d?e.val(d):e.val(e.data("base"));var f=$("#task_select");if(f.length>0){var g;f.find("option").filter(function(){return this.value||$.trim(this.value).length>0||$.trim(this.text).length>0}).remove(),$.each(a.billable_tasks,function(a,b){g=" ",g+=1==b.started_timers?'disabled class="text-danger important" data-subtext="'+invoice_task_billable_timers_found+'"':'data-subtext="'+b.rel_name+'"',f.append('<option value="'+b.id+'"'+g+">"+b.name+"</option>")}),f.selectpicker("refresh")}a.projects.length>0?($(".projects-wrapper").removeClass("hide"),b.append('<option value=""></option>'),$.each(a.projects,function(a,c){b.append('<option value="'+c.id+'">'+c.name+"</option>")})):$(".projects-wrapper").addClass("hide"),b.selectpicker("refresh"),e.selectpicker("refresh"),init_currency_symbol()},"json")}),0==$('input[name="isedit"]').length&&$('.f_client_id select[name="clientid"]').change(),$("body").on("click","#get_shipping_from_customer_profile",function(a){a.preventDefault();var b=$("#include_shipping");0==b.prop("checked")&&(b.prop("checked",!0),$("#shipping_details").removeClass("hide"));var c=$('select[name="clientid"]').val();""!=c&&$.get(admin_url+"clients/get_customer_billing_and_shipping_details/"+c,function(a){$('input[name="shipping_street"]').val(a[0].shipping_street),$('input[name="shipping_city"]').val(a[0].shipping_city),$('input[name="shipping_state"]').val(a[0].shipping_state),$('input[name="shipping_zip"]').val(a[0].shipping_zip),$('select[name="shipping_country"]').selectpicker("val",a[0].shipping_country)},"json")}),"undefined"!=typeof accounting&&(accounting.settings.currency.decimal=decimal_separator,accounting.settings.currency.thousand=thousand_separator,accounting.settings.currency.precision=decimal_places,accounting.settings.number.thousand=thousand_separator,accounting.settings.number.decimal=decimal_separator,accounting.settings.number.precision=decimal_places,calculate_total()),$("body").on("change",'input[name="invoices_to_merge[]"]',function(){var a=$(this).prop("checked"),b=$(this).val();1==a?$.get(admin_url+"invoices/get_merge_data/"+b,function(a){$.each(a.items,function(a,c){""!=c.rel_type&&("task"==c.rel_type?$('input[name="task_id"]').val(c.item_related_formated_for_input):"expense"==c.rel_type&&$('input[name="expense_id"]').val(c.item_related_formated_for_input)),add_item_to_table(c,"undefined",b)})},"json"):$("body").find('[data-merge-invoice="'+b+'"]').remove()}),$("body").on("change",'input[name="bill_expenses[]"]',function(){var a=$(this).prop("checked"),b=$(this).val();1==a?$.get(admin_url+"invoices/get_bill_expense_data/"+b,function(a){$('input[name="expense_id"]').val(b),add_item_to_table(a,"undefined","undefined",b)},"json"):($("body").find('[data-bill-expense="'+b+'"]').remove(),$("body").find('#billed-expenses input[value="'+b+'"]').remove())}),$("body").on("change",".invoice_inc_expense_additional_info input",function(){var a,b=$(this).attr("data-content"),c=$("[data-bill-expense="+$(this).attr("data-id")+"] .item_long_description");current_desc_val=c.val(),current_desc_val=current_desc_val.trim(),""!=b&&(1==$(this).prop("checked")?(a=current_desc_val+"\n"+b,c.val(a.trim())):(c.val(current_desc_val.replace("\n"+b,"")),c.val(current_desc_val.replace(b,""))))})}),jQuery.extend({highlight:function(a,b,c,d){if(3===a.nodeType){var e=a.data.match(b);if(e){var f=document.createElement(c||"span");f.className=d||"highlight";var g=a.splitText(e.index);g.splitText(e[0].length);var h=g.cloneNode(!0);return f.appendChild(h),g.parentNode.replaceChild(f,g),1}}else if(1===a.nodeType&&a.childNodes&&!/(script|style)/i.test(a.tagName)&&(a.tagName!==c.toUpperCase()||a.className!==d))for(var i=0;i<a.childNodes.length;i++)i+=jQuery.highlight(a.childNodes[i],b,c,d);return 0}}),jQuery.fn.highlight=function(a,b){var c={className:"highlight animated flash",element:"span",caseSensitive:!1,wordsOnly:!1};if(jQuery.extend(c,b),a.constructor===String&&(a=[a]),a=jQuery.grep(a,function(a,b){return""!=a}),a=jQuery.map(a,function(a,b){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}),0==a.length)return this;var d=c.caseSensitive?"":"i",e="("+a.join("|")+")";c.wordsOnly&&(e="\\b"+e+"\\b");var f=new RegExp(e,d);return this.each(function(){jQuery.highlight(this,f,c.element,c.className)})},$(function(){_validate_form($("#kb_group_form"),{name:"required"},manage_kb_groups),$("#kb_group_modal").on("hidden.bs.modal",function(a){$("#additional").html(""),$("#kb_group_modal input").val(""),$(".add-title").removeClass("hide"),$(".edit-title").removeClass("hide"),$('#kb_group_modal input[name="group_order"]').val($("table tbody tr").length+1)})}),jQuery.fn.unhighlight=function(a){var b={className:"highlight",element:"span"};return jQuery.extend(b,a),this.find(b.element+"."+b.className).each(function(){var a=this.parentNode;a.replaceChild(this.firstChild,this),a.normalize()}).end()},$("#newsfeed").scroll(function(a){var b=$(a.currentTarget);b[0].scrollHeight-b.scrollTop()==b.outerHeight()&&load_newsfeed(),$("#newsfeed .close_newsfeed").css("top",$(this).scrollTop()+20+"px")}),$(function(){_validate_form($("body").find("#leads-status-form"),{name:"required"},manage_leads_statuses),$("#status").on("hidden.bs.modal",function(a){$("#additional").html(""),$("#status input").val(""),$(".add-title").removeClass("hide"),$(".edit-title").removeClass("hide"),$('#status input[name="statusorder"]').val($("table tbody tr").length+1)})});