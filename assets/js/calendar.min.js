function view_event(a){"undefined"!=typeof a&&$.post(admin_url+"utilities/view_event/"+a).done(function(a){$("#event").html(a),$("#viewEvent").modal("show"),init_datepicker(),validate_calendar_form()})}function delete_event(a){$.get(admin_url+"utilities/delete_event/"+a,function(a){window.location.reload()},"json")}function validate_calendar_form(){_validate_form("._event form",{title:"required",start:"required"},calendar_form_handler)}function calendar_form_handler(a){return $.post(a.action,$(a).serialize()).done(function(a){a=JSON.parse(a),1==a.success&&(alert_float("success",a.message),setTimeout(function(){var a=window.location.href;a=a.split("?"),window.location.href=a[0]},700))}),!1}$(function(){validate_calendar_form();var a={customButtons:{},header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay,viewFullCalendar"},editable:!1,eventLimit:parseInt(calendar_events_limit)+1,views:{day:{eventLimit:!1}},defaultView:default_view_calendar,isRTL:"true"==isRTL,eventStartEditable:!1,timezone:timezone,firstDay:parseInt(calendar_first_day),year:moment.tz(timezone).format("YYYY"),month:moment.tz(timezone).format("M"),date:moment.tz(timezone).format("DD"),events:calendar_data,eventSources:[],eventLimitClick:function(a,b){$("#calendar").fullCalendar("gotoDate",a.date),$("#calendar").fullCalendar("changeView","basicDay")},eventRender:function(a,b){b.attr("title",a._tooltip),b.attr("onclick",a.onclick),b.attr("data-toggle","tooltip"),a.url||b.click(function(){view_event(a.eventid)})},dayClick:function(a,b,c){return $("#newEventModal").modal("show"),$.post(admin_url+"misc/format_date",{date:moment(a.format()).locale("en").format("YYYY-MM-DD")}).done(function(a){$("input[name='start'].datetimepicker").val(a)}),!1}};if($("body").hasClass("home")&&(a.customButtons.viewFullCalendar={text:calendar_expand,click:function(){window.location.href=admin_url+"utilities/calendar"}}),1==is_staff_member&&(""!=google_api&&(a.googleCalendarApiKey=google_api),""!=calendarIDs&&(calendarIDs=JSON.parse(calendarIDs),0!=calendarIDs.length)))if(""!=google_api)for(var b=0;b<calendarIDs.length;b++){var c={};c.googleCalendarId=calendarIDs[b],a.eventSources.push(c)}else console.error("You have setup Google Calendar IDs but you dont have specified Google API key. To setup Google API key navigate to Setup->Settings->Misc->Misc");$("#calendar").fullCalendar(a);var d=get_url_param("new_event");d&&($("#newEventModal").modal("show"),$("input[name='start'].datetimepicker").val(get_url_param("date")))});