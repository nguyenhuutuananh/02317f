function alert_float(a,b){var c,d;c=$("body").find("float-alert").length,c++,c="alert_float_"+c,d=$('<div id="'+c+'" class="float-alert animated fadeInRight col-xs-11 col-sm-4 alert alert-'+a+'"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><span>'+b+"</span></div>"),$("body").append(d),setTimeout(function(){$("#"+c).remove()},3e3)}function new_discussion(){$("#discussion").modal("show"),$("#discussion .edit-title").addClass("hide")}function manage_discussion(a){var b=$(a).serialize(),c=a.action;return $.post(c,b).done(function(a){a=JSON.parse(a),1==a.success&&alert_float("success",a.message),$(".table-project-discussions").DataTable().ajax.reload(),$("#discussion").modal("hide")}),!1}function remove_task_comment(a){$.get(site_url+"clients/remove_task_comment/"+a,function(a){1==a.success&&window.location.reload()},"json")}function edit_task_comment(a){var b=$('[data-edit-comment="'+a+'"]');b.removeClass("hide"),$('[data-comment-content="'+a+'"]').addClass("hide")}function cancel_edit_comment(a){var b=$('[data-edit-comment="'+a+'"]');b.addClass("hide"),$('[data-comment-content="'+a+'"]').removeClass("hide")}function save_edited_comment(a){var b={};b.id=a,b.content=$('[data-edit-comment="'+a+'"]').find("textarea").val(),$.post(site_url+"clients/edit_comment",b).done(function(b){b=JSON.parse(b),1==b.success?window.location.reload():cancel_edit_comment(a)})}function initDataTable(){var a,b,c,d={language:dt_lang,paginate:!0,responsive:!0,bLengthChange:!1,pageLength:tables_pagination_limit,order:[0,"DESC"]},e=$(".dt-table");$.each(e,function(){a=d,b=$(this).attr("data-order-col"),c=$(this).attr("data-order-type"),b&&c&&(a.order=[[b,c]]),$(this).DataTable(a)})}function get_url_param(a){var b={};return window.location.href.replace(location.hash,"").replace(/[?&]+([^=&]+)=?([^&]*)?/gi,function(a,c,d){b[c]=void 0!==d?d:""}),a?b[a]?b[a]:null:b}function fix_phases_height(){if(!is_mobile()){var a=Math.max.apply(null,$("div.tasks-phases .panel-body").map(function(){return $(this).outerHeight()}).get());$("div.tasks-phases .panel-body").css("min-height",a+"px")}}function color(a,b,c){return"rgb("+a+","+b+","+c+")"}function taskTable(){$(".tasks-table").toggleClass("hide"),$(".tasks-phases").toggleClass("hide")}function dt_custom_view(a,b,c){var d=$(a).DataTable();d.column(b).search(c).draw()}function discussion_comments(a,b,c){$(a).comments({roundProfilePictures:!0,textareaRows:4,textareaRowsOnFocus:6,enableDeleting:!1,profilePictureURL:discussion_user_profile_image_url,enableUpvoting:!1,enableAttachments:!0,popularText:"",enableDeletingCommentWithReplies:!0,textareaPlaceholderText:discussions_lang.discussion_add_comment,newestText:discussions_lang.discussion_newest,oldestText:discussions_lang.discussion_oldest,attachmentsText:discussions_lang.discussion_attachments,sendText:discussions_lang.discussion_send,replyText:discussions_lang.discussion_reply,editText:discussions_lang.discussion_edit,editedText:discussions_lang.discussion_edited,youText:discussions_lang.discussion_you,saveText:discussions_lang.discussion_save,deleteText:discussions_lang.discussion_delete,viewAllRepliesText:discussions_lang.discussion_view_all_replies+" (__replyCount__)",hideRepliesText:discussions_lang.discussion_hide_replies,noCommentsText:discussions_lang.discussion_no_comments,noAttachmentsText:discussions_lang.discussion_no_attachments,attachmentDropText:discussions_lang.discussion_attachments_drop,getComments:function(a,d){$.post(site_url+"clients/project/"+project_id,{action:"discussion_comments",discussion_id:b,discussion_type:c}).done(function(b){b=JSON.parse(b),a(b)})},postComment:function(a,d,e){a.action="new_discussion_comment",a.discussion_id=b,a.discussion_type=c,$.ajax({type:"post",url:site_url+"clients/project/"+project_id,data:a,success:function(a){a=JSON.parse(a),d(a)},error:e})},putComment:function(a,b,c){a.action="update_discussion_comment",$.ajax({type:"post",url:site_url+"clients/project/"+project_id,data:a,success:function(a){a=JSON.parse(a),b(a)},error:c})},deleteComment:function(a,b,c){$.ajax({type:"post",url:site_url+"clients/project/"+project_id,success:b,error:c,data:{id:a.id,action:"delete_discussion_comment"}})},timeFormatter:function(a){return moment(a).fromNow()},uploadAttachments:function(a,d,e){var f=0,g=[],h=function(){f++,f==a.length&&(0==g.length?e():(g=JSON.parse(g),d(g)))};$(a).each(function(a,d){var e=new FormData;$(Object.keys(d)).each(function(a,b){var c=d[b];c&&e.append(b,c)}),e.append("action","new_discussion_comment"),e.append("discussion_id",b),e.append("discussion_type",c),$.ajax({url:site_url+"clients/project/"+project_id,type:"POST",data:e,cache:!1,contentType:!1,processData:!1,success:function(a){g.push(a),h()},error:function(a){h()}})})}})}function view_project_file(a,b){$.post(site_url+"clients/project/"+b,{action:"get_file",id:a,project_id:b}).done(function(a){$("#project_file_data").html(a)}).fail(function(a){alert_float("danger",a.statusText)})}function update_file_data(a){var b={};b.id=a,b.subject=$('body input[name="file_subject"]').val(),b.description=$('body textarea[name="file_description"]').val(),b.action="update_file_data",$.post(site_url+"clients/project/"+project_id,b)}function close_modal_manualy(a){$(a).fadeOut("slow",function(){$(a).remove(),$(".modal-backdrop").remove(),$("body").removeClass("modal-open")})}function client_home_chart(){var a=$("#client-home-chart");if(0!=a.length){"undefined"!=typeof salesChart&&salesChart.destroy();var b={},c=$("#currency"),d=$("#payments_year");c.length>0&&(b.report_currency=$('select[name="currency"]').val()),d.length>0&&(b.year=$("#payments_year").val()),$.post(site_url+"clients/client_home_chart",b).done(function(b){b=JSON.parse(b),salesChart=new Chart(a,{type:"line",data:b,options:{responsive:!0,maintainAspectRatio:!1}})})}}var project_id=$('input[name="project_id"]').val(),discussion_user_profile_image_url=$('input[name="discussion_user_profile_image_url"]').val(),discussion_id=$('input[name="discussion_id"]').val();Dropzone.options.projectFilesUpload=!1,Dropzone.options.taskFileUpload=!1,Dropzone.options.filesUpload=!1;var salesChart;$(function(){fix_phases_height(),initDataTable(),moment.locale(locale);var a=get_url_param("file_id");if(a&&view_project_file(a,project_id),$("a[href='#top']").on("click",function(a){a.preventDefault(),$("html,body").animate({scrollTop:0},1e3),a.preventDefault()}),$("a[href='#bot']").on("click",function(a){a.preventDefault(),$("html,body").animate({scrollTop:$(document).height()},1e3),a.preventDefault()}),client_home_chart(),$('select[name="currency"],select[name="payments_years"]').on("change",function(){client_home_chart()}),discussion_comments("#discussion-comments",discussion_id,"regular"),$("body").on("show.bs.modal","._project_file",function(){discussion_comments("#project-file-discussion",discussion_id,"file")}),"undefined"!=typeof Dropbox&&($("#dropbox-chooser-task").length>0&&document.getElementById("dropbox-chooser-task").appendChild(Dropbox.createChooseButton({success:function(a){$.post(site_url+"clients/project/"+project_id,{files:a,task_id:$('input[name="task_id"]').val(),external:"dropbox",action:"add_task_external_file"}).done(function(){window.location.reload()})},linkType:"preview",extensions:allowed_files.split(",")})),$("#files-upload").length>0&&document.getElementById("dropbox-chooser-files").appendChild(Dropbox.createChooseButton({success:function(a){$.post(site_url+"clients/upload_files",{files:a,external:"dropbox"}).done(function(){window.location.reload()})},linkType:"preview",extensions:allowed_files.split(",")})),"undefined"!=typeof Dropbox&&$("#dropbox-chooser-project-files").length>0&&document.getElementById("dropbox-chooser-project-files").appendChild(Dropbox.createChooseButton({success:function(a){$.post(site_url+"clients/project/"+project_id,{files:a,external:"dropbox",action:"project_file_dropbox"}).done(function(){var a=window.location.href;window.location.href=a.split("?")[0]+"?group=project_files"})},linkType:"preview",extensions:allowed_files.split(",")}))),$("#files-upload").length>0&&new Dropzone("#files-upload",{paramName:"file",addRemoveLinks:!0,dictFileTooBig:file_exceds_maxfile_size_in_form,dictDefaultMessage:drop_files_here_to_upload,dictFallbackMessage:browser_not_support_drag_and_drop,dictRemoveFile:remove_file,maxFilesize:max_php_ini_upload_size.replace(/\D/g,""),accept:function(a,b){b()},success:function(a,b){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&window.location.reload()},acceptedFiles:allowed_files,error:function(a,b){alert_float("danger",b)}}),"undefined"!=typeof calendar_data){var b={header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},editable:!0,eventLimit:parseInt(calendar_events_limit)+1,views:{day:{eventLimit:!1}},defaultView:default_view_calendar,eventLimitClick:function(a,b){$("#calendar").fullCalendar("gotoDate",a.date),$("#calendar").fullCalendar("changeView","basicDay")},isRTL:"true"==isRTL,eventStartEditable:!1,firstDay:parseInt(calendar_first_day),events:calendar_data,eventRender:function(a,b){b.attr("title",a._tooltip),b.attr("onclick",a.onclick),b.attr("data-toggle","tooltip")}};$("#calendar").fullCalendar(b)}var c=get_url_param("group");c&&($("body").find(".nav-tabs li").removeClass("active"),$("body").find('.nav-tabs [data-group="'+c+'"]').parents("li").addClass("active"));for(var d=-10;d<$(".task-phase").not(".color-not-auto-adjusted").length/2;d++){var e=120,f=169,g=56;$(".task-phase:eq("+(d+10)+")").not(".color-not-auto-adjusted").css("background",color(e-13*d,f-13*d,g-13*d)).css("border","1px solid "+color(e-13*d,f-13*d,g-13*d))}$(".project-progress").circleProgress({fill:{gradient:["#D8EDA3","#D8EDA3"]}}).on("circle-animation-progress",function(a,b,c){$(this).find("strong.project-percent").html(parseInt(100*c)+"<i>%</i>")});$(".toggle-change-ticket-status").on("click",function(){$(".ticket-status,.ticket-status-inline").toggleClass("hide")}),$("#ticket_status_single").on("change",function(){data={},data.status_id=$(this).val(),data.ticket_id=$('input[name="ticket_id"]').val(),$.post(site_url+"clients/change_ticket_status/",data).done(function(){window.location.reload()})}),"undefined"!=typeof contracts_by_type&&new Chart($("#contracts-by-type-chart"),{type:"bar",data:JSON.parse(contracts_by_type),options:{responsive:!0,maintainAspectRatio:!1,scales:{yAxes:[{display:!0,ticks:{beginAtZero:!0}}]}}}),$("#task-file-upload").length>0&&new Dropzone("#task-file-upload",{paramName:"file",addRemoveLinks:!0,dictFileTooBig:file_exceds_maxfile_size_in_form,dictDefaultMessage:drop_files_here_to_upload,maxFilesize:max_php_ini_upload_size.replace(/\D/g,""),dictFallbackMessage:browser_not_support_drag_and_drop,dictRemoveFile:remove_file,accept:function(a,b){b()},sending:function(a,b,c){c.append("action","upload_task_file"),c.append("task_id",$('input[name="task_id"]').val())},success:function(a,b){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&window.location.reload()},acceptedFiles:allowed_files,error:function(a,b){alert_float("danger",b)}}),$("#project-files-upload").length>0&&new Dropzone("#project-files-upload",{paramName:"file",dictFileTooBig:file_exceds_maxfile_size_in_form,dictDefaultMessage:drop_files_here_to_upload,dictFallbackMessage:browser_not_support_drag_and_drop,dictRemoveFile:remove_file,maxFilesize:max_php_ini_upload_size.replace(/\D/g,""),addRemoveLinks:!0,accept:function(a,b){b()},sending:function(a,b,c){c.append("action","upload_file")},success:function(a,b){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&window.location.reload()},acceptedFiles:allowed_files,error:function(a,b){alert_float("danger",b)}}),$(".add_more_attachments").on("click",function(){if($(this).hasClass("disabled"))return!1;var a=$('input[name="attachments[]"]').length;if(a>=maximum_allowed_ticket_attachments)return!1;var b=$(".attachments").find(".attachment").eq(0).clone().appendTo(".attachments");$(b).find("input").val(""),$(b).find("i").removeClass("fa-plus").addClass("fa-minus"),$(b).find("button").removeClass("add_more_attachments").addClass("remove_attachment").removeClass("btn-success").addClass("btn-danger")}),$("body").on("click",".remove_attachment",function(){$(this).parents(".attachment").remove()}),$(".single-ticket-add-reply").on("click",function(a){a.preventDefault();var b=$(".single-ticket-reply-area");b.slideToggle()}),$('body.viewinvoice input[name="amount"]').on("keyup",function(){var a=$(this).data("total"),b=$(this).val(),c=$(this).parents(".form-group");b>a?(c.addClass("has-error"),0==c.find("p.text-danger").length&&(c.append('<p class="text-danger">Maximum pay value passed</p>'),$(this).parents("form").find('input[name="make_payment"]').attr("disabled",!0))):(c.removeClass("has-error"),c.find("p.text-danger").remove(),$(this).parents("form").find('input[name="make_payment"]').attr("disabled",!1))}),$("#discussion_form").validate({rules:{subject:"required"}}),$("#discussion").on("hidden.bs.modal",function(a){$('#discussion input[name="subject"]').val(""),$('#discussion textarea[name="description"]').val(""),$("#discussion .add-title").removeClass("hide"),$("#discussion .edit-title").removeClass("hide")})});