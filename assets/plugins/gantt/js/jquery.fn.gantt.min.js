!function(e,t){"use strict";function a(t,a){var n=new Date(parseInt(a,10));n.setHours(0,0,0,0);var l=e(t).attr("id")||"",i=l.indexOf("-")+1,s=new Date(parseInt(l.substring(i,l.length),10));return s.setHours(0,0,0,0),n.getTime()===s.getTime()}function n(t,a){var n=new Date(parseInt(a,10)),l=n.getFullYear(),i=n.getWeekOfYear(),s=n.getMonth();11===s&&1===i?l++:!s&&i>51&&l--,n=l+"-"+i;var o=e(t).attr("id")||"",r=o.indexOf("-")+1,d=o.substring(r,o.length);return n===d}function l(t,a){var n=new Date(parseInt(a,10));n=n.getFullYear()+"-"+n.getMonth();var l=e(t).attr("id")||"",i=l.indexOf("-")+1,s=l.substring(i,l.length);return n===s}function i(e,t){for(var a=1;;a++){var n=new Date(e);if(n.setHours(e.getHours()+t*a),n.getTime()!==e.getTime())return n}}var s=864e5;e.expr[":"].findday=e.expr.createPseudo?e.expr.createPseudo(function(e){return function(t){return a(t,e)}}):function(e,t,n){return a(e,n[3])},e.expr[":"].findweek=e.expr.createPseudo?e.expr.createPseudo(function(e){return function(t){return n(t,e)}}):function(e,t,a){return n(e,a[3])},e.expr[":"].findmonth=e.expr.createPseudo?e.expr.createPseudo(function(e){return function(t){return l(t,e)}}):function(e,t,a){return l(e,a[3])},Date.prototype.getWeekId=function(){var e=this.getFullYear(),t=this.getWeekOfYear(),a=this.getMonth();return 11===a&&1===t?e++:!a&&t>51&&e--,"dh-"+e+"-"+t},Date.prototype.getRepDate=function(e){switch(e){case"hours":return this.getTime();case"weeks":return this.getDayForWeek().getTime();case"months":return new Date(this.getFullYear(),this.getMonth(),1).getTime();case"days":default:return this.getTime()}},Date.prototype.getDayOfYear=function(){var e=this.getFullYear();return(Date.UTC(e,this.getMonth(),this.getDate())-Date.UTC(e,0,0))/s};var o=1,r=4;Date.prototype.getWeekOfYear=function(){var e=this.getFullYear(),t=this.getMonth(),a=this.getDate(),n=this.getDay(),l=r-n;return o>n&&(l-=7),r-o>l+7&&(l+=7),Math.ceil(new Date(e,t,a+l).getDayOfYear()/7)},Date.prototype.getDayForWeek=function(){var e=this.getDay(),t=(o>e?-7:0)+o-e;return new Date(this.getFullYear(),this.getMonth(),this.getDate()+t)},e.fn.gantt=function(a){var n=["hours","days","weeks","months"],l={source:[],holidays:[],itemsPerPage:7,dow:["S","M","T","W","T","F","S"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],waitText:"Please wait...",navigate:"buttons",scrollToToday:!0,useCookie:!1,cookieKey:"jquery.fn.gantt",scale:"days",maxScale:"months",minScale:"hours",onItemClick:function(e){},onAddClick:function(e,t){},onRender:e.noop};e.extend(l,a),l.useCookie=l.useCookie&&e.isFunction(e.cookie);var o={elementFromPoint:function(){return"CSS1Compat"===document.compatMode?function(e,t){return e-=window.pageXOffset,t-=window.pageYOffset,document.elementFromPoint(e,t)}:function(t,a){return t-=e(document).scrollLeft(),a-=e(document).scrollTop(),document.elementFromPoint(t,a)}}(),create:function(t){"string"!=typeof l.source?(t.data=l.source,o.init(t)):e.getJSON(l.source,function(e){t.data=e,o.init(t)})},init:function(t){t.rowsNum=t.data.length,t.pageCount=Math.ceil(t.rowsNum/l.itemsPerPage),t.rowsOnLastPage=t.rowsNum-Math.floor(t.rowsNum/l.itemsPerPage)*l.itemsPerPage,t.dateStart=r.getMinDate(t),t.dateEnd=r.getMaxDate(t),t.dateStart=r.getMinDate(t),t.dateEnd=r.getMaxDate(t);var a=t.dateEnd-t.dateStart,n=function(){switch(l.scale){case"months":return 31;case"weeks":return 7;default:return 1}}(),i=864e5*n,s=Math.ceil(a/i)+1,d=Math.ceil(e(t).width()/r.getCellSize()),c=d-s;c>0&&t.dateEnd.setDate(t.dateEnd.getDate()+c*n),o.waitToggle(t,function(){o.render(t)})},render:function(t){var a=e('<div class="fn-content"/>'),n=o.leftPanel(t);a.append(n);var i,s,r=o.rightPanel(t,n);a.append(r),a.append(o.navigation(t));var d=r.find(".dataPanel");if(t.gantt=e('<div class="fn-gantt" />').append(a),e(t).empty().append(t.gantt),t.scrollNavigation.panelMargin=parseInt(d.css("margin-left").replace("px",""),10),t.scrollNavigation.panelMaxPos=d.width()-r.width(),t.scrollNavigation.canScroll=d.width()>r.width(),o.markNow(t),o.fillData(t,d,n),l.useCookie){var c=e.cookie(l.cookieKey+"ScrollPos");c&&(t.hPosition=c)}l.scrollToToday?(o.navigateTo(t,"now"),o.scrollPanel(t,0)):(0!==t.hPosition&&(t.scaleOldWidth&&(i=d.width()-r.width(),s=i*t.hPosition/t.scaleOldWidth,t.hPosition=s>0?0:s,t.scaleOldWidth=null),d.css({"margin-left":t.hPosition}),t.scrollNavigation.panelMargin=t.hPosition),o.repositionLabel(t)),d.css({height:n.height()}),o.waitToggle(t),l.onRender()},leftPanel:function(t){var a=e('<div class="leftPanel"/>').append(e('<div class="row spacer"/>').css("height",r.getCellSize()*t.headerRows).css("width","100%")),n=[];return e.each(t.data,function(e,a){if(e>=t.pageNum*l.itemsPerPage&&e<t.pageNum*l.itemsPerPage+l.itemsPerPage){var i="id"in a?'" data-id="'+a.id:"";n.push('<div class="row name row'+e+(a.desc?"":" fn-wide "+i)+'" id="rowheader'+e+'" data-offset="'+e%l.itemsPerPage*r.getCellSize()+'"><span class="fn-label'+(a.cssClass?" "+a.cssClass:"")+'">'+(a.name||"")+"</span></div>"),a.desc&&n.push('<div class="row desc row'+e+' " id="RowdId_'+e+i+'"><span class="fn-label'+(a.cssClass?" "+a.cssClass:"")+'">'+a.desc+"</span></div>")}}),a.append(n.join(""))},dataPanel:function(a,n){var i=e('<div class="dataPanel" style="width: '+n+'px;"/>'),s="onwheel"in a?"wheel":document.onmousewheel!==t?"mousewheel":"DOMMouseScroll";return e(a).on(s,function(e){o.wheelScroll(a,e)}),i.click(function(t){t.stopPropagation();var n,i=e(a).find(".fn-gantt .leftPanel"),s=e(a).find(".fn-gantt .dataPanel");switch(l.scale){case"months":n=r.getCellSize();break;case"hours":n=4*r.getCellSize();break;case"days":n=3*r.getCellSize();break;case"weeks":default:n=2*r.getCellSize()}var d=o.elementFromPoint(t.pageX,s.offset().top+n);d=e("fn-label"===d.className?d.parentNode:d);var c=d.data("repdate"),g=o.elementFromPoint(i.offset().left+i.width()-10,t.pageY);g=e(0===g.className.indexOf("fn-label")?g.parentNode:g);var u=g.data("id");l.onAddClick(c,u)}),i},rightPanel:function(t,a){var n=null,s=["sn","wd","wd","wd","wd","wd","sa"],d=[],c=0,g=[],u=0,h=[],p=0,f=[],v=[],m=new Date;m.setHours(0,0,0,0);var w,y,b,D,k,S,P,C,M,z=e('<div class="row header"></div>');switch(l.scale){case"hours":for(n=r.parseTimeRange(t.dateStart,t.dateEnd,t.scaleStep),b=n[0].getFullYear(),D=n[0].getMonth(),S=n[0],w=0,y=n.length;y>w;w++){P=n[w];var T=P.getFullYear();T!==b&&(d.push('<div class="row header year" style="width: '+r.getCellSize()*c+'px;"><div class="fn-label">'+b+"</div></div>"),b=T,c=0),c++;var N=P.getMonth();N!==D&&(g.push('<div class="row header month" style="width: '+r.getCellSize()*u+'px"><div class="fn-label">'+l.months[D]+"</div></div>"),D=N,u=0),u++;var x=P.getDay(),Y=S.getDay();x!==Y&&(C=m-S===0?"today":r.isHoliday(S.getTime())?"holiday":s[Y],h.push('<div class="row date '+C+'" style="width: '+r.getCellSize()*p+'px;"><div class="fn-label">'+S.getDate()+"</div></div>"),f.push('<div class="row day '+C+'" style="width: '+r.getCellSize()*p+'px;"><div class="fn-label">'+l.dow[Y]+"</div></div>"),S=P,p=0),p++,C=s[x],r.isHoliday(P)&&(C="holiday"),v.push('<div class="row day '+C+'" id="dh-'+P.getTime()+'" data-offset="'+w*r.getCellSize()+'" data-repdate="'+P.getRepDate(l.scale)+'"><div class="fn-label">'+P.getHours()+"</div></div>")}d.push('<div class="row header year" style="width: '+r.getCellSize()*c+'px;"><div class="fn-label">'+b+"</div></div>"),g.push('<div class="row header month" style="width: '+r.getCellSize()*u+'px"><div class="fn-label">'+l.months[D]+"</div></div>"),C=s[S.getDay()],r.isHoliday(S)&&(C="holiday"),h.push('<div class="row date '+C+'" style="width: '+r.getCellSize()*p+'px;"><div class="fn-label">'+S.getDate()+"</div></div>"),f.push('<div class="row day '+C+'" style="width: '+r.getCellSize()*p+'px;"><div class="fn-label">'+l.dow[S.getDay()]+"</div></div>"),M=o.dataPanel(t,n.length*r.getCellSize()),M.append(z.clone().html(d.join("")),z.clone().html(g.join("")),z.clone().html(h.join("")),z.clone().html(f.join("")),z.clone().html(v.join("")));break;case"weeks":n=r.parseWeeksRange(t.dateStart,t.dateEnd),b=n[0].getFullYear(),D=n[0].getMonth(),k=n[0].getWeekOfYear();var F;for(w=0,y=n.length;y>w;w++)P=n[w],k>(k=P.getWeekOfYear())&&(F=P.getDate()-1,F-=P.getMonth()?31:0,F/=7,d.push('<div class="row header year" style="width: '+r.getCellSize()*(c-F)+'px;"><div class="fn-label">'+b+"</div></div>"),b++,c=F),c++,P.getMonth()!==D&&(F=P.getDate()-1,F/=7,g.push('<div class="row header month" style="width:'+r.getCellSize()*(u-F)+'px;"><div class="fn-label">'+l.months[D]+"</div></div>"),D=P.getMonth(),u=F),u++,h.push('<div class="row day wd" id="'+P.getWeekId()+'" data-offset="'+w*r.getCellSize()+'" data-repdate="'+P.getRepDate(l.scale)+'"><div class="fn-label">'+k+"</div></div>");d.push('<div class="row header year" style="width: '+r.getCellSize()*c+'px;"><div class="fn-label">'+b+"</div></div>"),g.push('<div class="row header month" style="width: '+r.getCellSize()*u+'px"><div class="fn-label">'+l.months[D]+"</div></div>"),M=o.dataPanel(t,n.length*r.getCellSize()),M.append(z.clone().html(d.join("")),z.clone().html(g.join("")),z.clone().html(h.join("")));break;case"months":for(n=r.parseMonthsRange(t.dateStart,t.dateEnd),b=n[0].getFullYear(),D=n[0].getMonth(),w=0,y=n.length;y>w;w++)P=n[w],P.getFullYear()!==b&&(d.push('<div class="row header year" style="width: '+r.getCellSize()*c+'px;"><div class="fn-label">'+b+"</div></div>"),b=P.getFullYear(),c=0),c++,g.push('<div class="row day wd" id="dh-'+r.genId(P)+'" data-offset="'+w*r.getCellSize()+'" data-repdate="'+P.getRepDate(l.scale)+'">'+(1+P.getMonth())+"</div>");d.push('<div class="row header year" style="width: '+r.getCellSize()*c+'px;"><div class="fn-label">'+b+"</div></div>"),g.push('<div class="row header month" style="width: '+r.getCellSize()*u+'px"><div class="fn-label">'+l.months[D]+"</div></div>"),M=o.dataPanel(t,n.length*r.getCellSize()),M.append(z.clone().html(d.join("")),z.clone().html(g.join("")),z.clone().html(h.join("")),z.clone().html(f.join("")));break;default:n=r.parseDateRange(t.dateStart,t.dateEnd);var O=i(n[0],-1);for(b=O.getFullYear(),D=O.getMonth(),w=0,y=n.length;y>w;w++)P=n[w],P.getFullYear()!==b&&(d.push('<div class="row header year" style="width:'+r.getCellSize()*c+'px;"><div class="fn-label">'+b+"</div></div>"),b=P.getFullYear(),c=0),c++,P.getMonth()!==D&&(g.push('<div class="row header month" style="width:'+r.getCellSize()*u+'px;"><div class="fn-label">'+l.months[D]+"</div></div>"),D=P.getMonth(),u=0),u++,S=P.getDay(),C=s[S],r.isHoliday(P)&&(C="holiday"),h.push('<div class="row date '+C+'" id="dh-'+r.genId(P)+'" data-offset="'+w*r.getCellSize()+'" data-repdate="'+P.getRepDate(l.scale)+'"><div class="fn-label">'+P.getDate()+"</div></div>"),f.push('<div class="row day '+C+'" id="dw-'+r.genId(P)+'" data-repdate="'+P.getRepDate(l.scale)+'"><div class="fn-label">'+l.dow[S]+"</div></div>");d.push('<div class="row header year" style="width: '+r.getCellSize()*c+'px;"><div class="fn-label">'+b+"</div></div>"),g.push('<div class="row header month" style="width: '+r.getCellSize()*u+'px"><div class="fn-label">'+l.months[D]+"</div></div>"),M=o.dataPanel(t,n.length*r.getCellSize()),M.append(z.clone().html(d.join("")),z.clone().html(g.join("")),z.clone().html(h.join("")),z.clone().html(f.join("")))}return e('<div class="rightPanel"></div>').append(M)},navigation:function(t){var a=null;return"scroll"===l.navigate?(a=e('<div class="navigate" />').append(e('<div class="nav-slider" />').append(e('<div class="nav-slider-left" />').append(e('<button type="button" class="nav-link nav-page-back"/>').html("&lt;").click(function(){o.navigatePage(t,-1)})).append(e('<div class="page-number"/>').append(e("<span/>").html(t.pageNum+1+" / "+t.pageCount))).append(e('<button type="button" class="nav-link nav-page-next"/>').html("&gt;").click(function(){o.navigatePage(t,1)})).append(e('<button type="button" class="nav-link nav-now"/>').html("&#9679;").click(function(){o.navigateTo(t,"now")})).append(e('<button type="button" class="nav-link nav-prev-week"/>').html("&lt;&lt;").click(function(){"hours"===l.scale?o.navigateTo(t,8*r.getCellSize()):"days"===l.scale?o.navigateTo(t,30*r.getCellSize()):"weeks"===l.scale?o.navigateTo(t,12*r.getCellSize()):"months"===l.scale&&o.navigateTo(t,6*r.getCellSize())})).append(e('<button type="button" class="nav-link nav-prev-day"/>').html("&lt;").click(function(){"hours"===l.scale?o.navigateTo(t,4*r.getCellSize()):"days"===l.scale?o.navigateTo(t,7*r.getCellSize()):"weeks"===l.scale?o.navigateTo(t,4*r.getCellSize()):"months"===l.scale&&o.navigateTo(t,3*r.getCellSize())}))).append(e('<div class="nav-slider-content" />').append(e('<div class="nav-slider-bar" />').append(e('<a class="nav-slider-button" />')).mousedown(function(e){e.preventDefault(),t.scrollNavigation.scrollerMouseDown=!0,o.sliderScroll(t,e)}).mousemove(function(e){t.scrollNavigation.scrollerMouseDown&&o.sliderScroll(t,e)}))).append(e('<div class="nav-slider-right" />').append(e('<button type="button" class="nav-link nav-next-day"/>').html("&gt;").click(function(){"hours"===l.scale?o.navigateTo(t,-4*r.getCellSize()):"days"===l.scale?o.navigateTo(t,-7*r.getCellSize()):"weeks"===l.scale?o.navigateTo(t,-4*r.getCellSize()):"months"===l.scale&&o.navigateTo(t,-3*r.getCellSize())})).append(e('<button type="button" class="nav-link nav-next-week"/>').html("&gt;&gt;").click(function(){"hours"===l.scale?o.navigateTo(t,-8*r.getCellSize()):"days"===l.scale?o.navigateTo(t,-30*r.getCellSize()):"weeks"===l.scale?o.navigateTo(t,-12*r.getCellSize()):"months"===l.scale&&o.navigateTo(t,-6*r.getCellSize())})).append(e('<button type="button" class="nav-link nav-zoomIn"/>').html("&#43;").click(function(){o.zoomInOut(t,-1)})).append(e('<button type="button" class="nav-link nav-zoomOut"/>').html("&#45;").click(function(){o.zoomInOut(t,1)})))),e(document).mouseup(function(){t.scrollNavigation.scrollerMouseDown=!1})):a=e('<div class="navigate" />').append(e('<button type="button" class="nav-link nav-page-back"/>').html("&lt;").click(function(){o.navigatePage(t,-1)})).append(e('<div class="page-number"/>').append(e("<span/>").html(t.pageNum+1+" / "+t.pageCount))).append(e('<button type="button" class="nav-link nav-page-next"/>').html("&gt;").click(function(){o.navigatePage(t,1)})).append(e('<button type="button" class="nav-link nav-begin"/>').html("&#124;&lt;").click(function(){o.navigateTo(t,"begin")})).append(e('<button type="button" class="nav-link nav-prev-week"/>').html("&lt;&lt;").click(function(){o.navigateTo(t,7*r.getCellSize())})).append(e('<button type="button" class="nav-link nav-prev-day"/>').html("&lt;").click(function(){o.navigateTo(t,r.getCellSize())})).append(e('<button type="button" class="nav-link nav-now"/>').html("&#9679;").click(function(){o.navigateTo(t,"now")})).append(e('<button type="button" class="nav-link nav-next-day"/>').html("&gt;").click(function(){o.navigateTo(t,-1*r.getCellSize())})).append(e('<button type="button" class="nav-link nav-next-week"/>').html("&gt;&gt;").click(function(){o.navigateTo(t,-7*r.getCellSize())})).append(e('<button type="button" class="nav-link nav-end"/>').html("&gt;&#124;").click(function(){o.navigateTo(t,"end")})).append(e('<button type="button" class="nav-link nav-zoomIn"/>').html("&#43;").click(function(){o.zoomInOut(t,-1)})).append(e('<button type="button" class="nav-link nav-zoomOut"/>').html("&#45;").click(function(){o.zoomInOut(t,1)})),e('<div class="bottom"></div>').append(a)},createProgressBar:function(t,a,n,i,s){a=a||"";var o=r.getCellSize(),d=r.getProgressBarMargin()||0,c=e('<div class="bar"><div class="fn-label">'+a+"</div></div>").css({width:o*t-d+2}).data("dataObj",s);return n&&c.mouseenter(function(t){var a=e('<div class="fn-gantt-hint" />').html(n);e("body").append(a),a.css("left",t.pageX),a.css("top",t.pageY),a.show()}).mouseleave(function(){e(".fn-gantt-hint").remove()}).mousemove(function(t){e(".fn-gantt-hint").css("left",t.pageX),e(".fn-gantt-hint").css("top",t.pageY+15)}),i&&c.addClass(i),c.click(function(t){t.stopPropagation(),l.onItemClick(e(this).data("dataObj"))}),c},markNow:function(t){var a=(new Date).setHours(0,0,0,0);switch(l.scale){case"weeks":e(t).find(':findweek("'+a+'")').removeClass("wd").addClass("today");break;case"months":e(t).find(':findmonth("'+a+'")').removeClass("wd").addClass("today");break;case"days":case"hours":default:e(t).find(':findday("'+a+'")').removeClass("wd").addClass("today")}},fillData:function(t,a,n){var i=function(e){try{e=e.replace("rgb(","").replace(")","");var t=e.split(","),a=parseInt(t[0],10),n=parseInt(t[1],10),l=parseInt(t[2],10),i=Math.round(.9*(255-(.299*a+.587*n+.114*l)));return"rgb("+i+", "+i+", "+i+")"}catch(s){return""}};e.each(t.data,function(n,d){n>=t.pageNum*l.itemsPerPage&&n<t.pageNum*l.itemsPerPage+l.itemsPerPage&&e.each(d.values,function(d,c){var g,u,h,p,f,v,m,w,y,b;switch(l.scale){case"hours":v=r.genId(r.dateDeserialize(c.from),t.scaleStep),u=e(t).find("#dh-"+v),m=r.genId(r.dateDeserialize(c.to),t.scaleStep),h=e(t).find("#dh-"+m),p=u.data("offset"),f=h.data("offset"),w=Math.floor((f-p)/r.getCellSize())+1,g=o.createProgressBar(w,c.label,c.desc,c.customClass,c.dataObj),y=e(t).find("#rowheader"+n),b=5*r.getCellSize()+2+y.data("offset"),g.css({top:b,left:Math.floor(p)}),a.append(g);break;case"weeks":v=r.dateDeserialize(c.from),m=r.dateDeserialize(c.to),u=e(t).find("#"+v.getWeekId()),p=u.data("offset"),h=e(t).find("#"+m.getWeekId()),f=h.data("offset"),w=Math.round((f-p)/r.getCellSize())+1,g=o.createProgressBar(w,c.label,c.desc,c.customClass,c.dataObj),y=e(t).find("#rowheader"+n),b=3*r.getCellSize()+2+y.data("offset"),g.css({top:b,left:Math.floor(p)}),a.append(g);break;case"months":v=r.dateDeserialize(c.from),m=r.dateDeserialize(c.to),v.getDate()<=3&&0===v.getMonth()&&v.setDate(v.getDate()+4),v.getDate()<=3&&0===v.getMonth()&&v.setDate(v.getDate()+4),m.getDate()<=3&&0===m.getMonth()&&m.setDate(m.getDate()+4),u=e(t).find("#dh-"+r.genId(v)),p=u.data("offset"),h=e(t).find("#dh-"+r.genId(m)),f=h.data("offset"),w=Math.round((f-p)/r.getCellSize())+1,g=o.createProgressBar(w,c.label,c.desc,c.customClass,c.dataObj),y=e(t).find("#rowheader"+n),b=2*r.getCellSize()+2+y.data("offset"),g.css({top:b,left:Math.floor(p)}),a.append(g);break;case"days":default:v=r.genId(r.dateDeserialize(c.from)),m=r.genId(r.dateDeserialize(c.to)),u=e(t).find("#dh-"+v),p=u.data("offset"),w=Math.floor((m-v)/s)+1,g=o.createProgressBar(w,c.label,c.desc,c.customClass,c.dataObj),y=e(t).find("#rowheader"+n),b=4*r.getCellSize()+2+y.data("offset"),g.css({top:b,left:Math.floor(p)}),a.append(g)}var D=g.find(".fn-label");if(D&&g.length){var k=i(g[0].style.backgroundColor);D.css("color",k)}else D&&D.css("color","")})})},navigateTo:function(t,a){var n,l,i=e(t).find(".fn-gantt .rightPanel"),s=i.find(".dataPanel"),r=i.width(),d=s.width(),c=function(){o.repositionLabel(t)};switch(a){case"begin":s.animate({"margin-left":"0px"},"fast",c),t.scrollNavigation.panelMargin=0;break;case"end":var g=d-r;t.scrollNavigation.panelMargin=-1*g,s.animate({"margin-left":"-"+g},"fast",c);break;case"now":if(!t.scrollNavigation.canScroll||!s.find(".today").length)return!1;n=-1*(d-r),l=s.css("margin-left").replace("px",""),a=s.find(".today").offset().left-s.offset().left,a*=-1,a>0?a=0:n>a&&(a=n),s.animate({"margin-left":a},"fast",c),t.scrollNavigation.panelMargin=a;break;default:n=-1*(d-r),l=s.css("margin-left").replace("px",""),a=parseInt(l,10)+a,0>=a&&a>=n&&s.animate({"margin-left":a},"fast",c),t.scrollNavigation.panelMargin=a}o.synchronizeScroller(t)},navigatePage:function(t,a){t.pageNum+a>=0&&t.pageNum+a<Math.ceil(t.rowsNum/l.itemsPerPage)&&o.waitToggle(t,function(){t.pageNum+=a,t.hPosition=e(".fn-gantt .dataPanel").css("margin-left").replace("px",""),t.scaleOldWidth=!1,o.init(t)})},zoomInOut:function(t,a){o.waitToggle(t,function(){var i=0>a,s=t.scaleStep+3*a;s=1>=s?1:4===s?3:s;var r=l.scale,d=t.headerRows;if("hours"===l.scale&&s>=13?(r="days",d=4,s=13):"days"===l.scale&&i?(r="hours",d=5,s=12):"days"!==l.scale||i?"weeks"!==l.scale||i?"weeks"===l.scale&&i?(r="days",d=4,s=13):"months"===l.scale&&i&&(r="weeks",d=3,s=13):(r="months",d=2,s=14):(r="weeks",d=3,s=13),i&&e.inArray(r,n)<e.inArray(l.minScale,n)||!i&&e.inArray(r,n)>e.inArray(l.maxScale,n))return void o.init(t);t.scaleStep=s,l.scale=r,t.headerRows=d;var c=e(t).find(".fn-gantt .rightPanel"),g=c.find(".dataPanel");t.hPosition=g.css("margin-left").replace("px",""),t.scaleOldWidth=g.width()-c.width(),l.useCookie&&(e.cookie(l.cookieKey+"CurrentScale",l.scale),e.cookie(l.cookieKey+"ScrollPos",null)),o.init(t)})},mouseScroll:function(t,a){var n=e(t).find(".fn-gantt .dataPanel");n.css("cursor","move");var l=(n.offset(),null===t.scrollNavigation.mouseX?a.pageX:t.scrollNavigation.mouseX),i=a.pageX-l;t.scrollNavigation.mouseX=a.pageX,o.scrollPanel(t,i),clearTimeout(t.scrollNavigation.repositionDelay),t.scrollNavigation.repositionDelay=setTimeout(o.repositionLabel,50,t)},wheelScroll:function(e,t){t.preventDefault();var a="detail"in t?t.detail:"wheelDelta"in t.originalEvent?-1/120*t.originalEvent.wheelDelta:t.originalEvent.deltaY?t.originalEvent.deltaY/Math.abs(t.originalEvent.deltaY):t.originalEvent.detail;o.scrollPanel(e,-50*a),clearTimeout(e.scrollNavigation.repositionDelay),e.scrollNavigation.repositionDelay=setTimeout(o.repositionLabel,50,e)},sliderScroll:function(t,a){var n,l,i=e(t).find(".nav-slider-bar"),s=i.find(".nav-slider-button"),r=e(t).find(".fn-gantt .rightPanel"),d=r.find(".dataPanel"),c=i.offset(),g=i.width(),u=s.width();if(a.pageX>=c.left&&a.pageX<=c.left+g){n=a.pageX-c.left,n-=u/2,s.css("left",n),l=d.width()-r.width();var h=n*l/g*-1;h>=0?(d.css("margin-left","0px"),t.scrollNavigation.panelMargin=0):n>=g-1*u?(d.css("margin-left",-1*l),t.scrollNavigation.panelMargin=-1*l):(d.css("margin-left",h),t.scrollNavigation.panelMargin=h),clearTimeout(t.scrollNavigation.repositionDelay),t.scrollNavigation.repositionDelay=setTimeout(o.repositionLabel,5,t)}},scrollPanel:function(t,a){if(!t.scrollNavigation.canScroll)return!1;var n=parseInt(t.scrollNavigation.panelMargin,10)+a;n>0?(t.scrollNavigation.panelMargin=0,e(t).find(".fn-gantt .dataPanel").css("margin-left",t.scrollNavigation.panelMargin)):n<-1*t.scrollNavigation.panelMaxPos?(t.scrollNavigation.panelMargin=-1*t.scrollNavigation.panelMaxPos,e(t).find(".fn-gantt .dataPanel").css("margin-left",t.scrollNavigation.panelMargin)):(t.scrollNavigation.panelMargin=n,e(t).find(".fn-gantt .dataPanel").css("margin-left",t.scrollNavigation.panelMargin)),o.synchronizeScroller(t)},synchronizeScroller:function(t){if("scroll"===l.navigate){var a=e(t).find(".fn-gantt .rightPanel"),n=a.find(".dataPanel"),i=e(t).find(".nav-slider-bar"),s=i.find(".nav-slider-button"),o=i.width(),r=s.width(),d=n.width()-a.width(),c=n.css("margin-left")||0;c&&(c=c.replace("px",""));var g=c*o/d-.25*s.width();g=g>0?0:-1*g>=o-.75*r?-1*(o-1.25*r):g,s.css("left",-1*g)}},repositionLabel:function(t){setTimeout(function(){var a;if(t){var n=e(t).find(".fn-gantt .rightPanel");a=n.find(".dataPanel")}else a=e(".fn-gantt .rightPanel .dataPanel");l.useCookie&&e.cookie(l.cookieKey+"ScrollPos",a.css("margin-left").replace("px",""))},500)},waitToggle:function(t,a){if(e.isFunction(a)){var n=e(t);n.offset(),n.outerWidth(),n.outerHeight();t.loader||(t.loader=e('<div class="fn-gantt-loader"><div class="fn-gantt-loader-spinner"><span>'+l.waitText+"</span></div></div>")),n.append(t.loader),setTimeout(a,500)}else t.loader&&t.loader.detach()}},r={getMaxDate:function(t){var a=null;e.each(t.data,function(t,n){e.each(n.values,function(e,t){a=a<r.dateDeserialize(t.to)?r.dateDeserialize(t.to):a})}),a=a||new Date;var n;switch(l.scale){case"hours":a.setHours(Math.ceil(a.getHours()/t.scaleStep)*t.scaleStep),a.setHours(a.getHours()+3*t.scaleStep);break;case"weeks":n=new Date(a.getTime()),n=new Date(n.setDate(n.getDate()+21));var i=7*Math.floor(n.getDate()/7);a=new Date(n.getFullYear(),n.getMonth(),0===i?4:i-3);break;case"months":n=new Date(a.getFullYear(),a.getMonth(),1),n.setMonth(n.getMonth()+2),a=new Date(n.getFullYear(),n.getMonth(),1);break;case"days":default:a.setHours(0),a.setDate(a.getDate()+3)}return a},getMinDate:function(t){var a=null;switch(e.each(t.data,function(t,n){e.each(n.values,function(e,t){a=a>r.dateDeserialize(t.from)||null===a?r.dateDeserialize(t.from):a})}),a=a||new Date,l.scale){case"hours":a.setHours(Math.floor(a.getHours()/t.scaleStep)*t.scaleStep),a.setHours(a.getHours()-3*t.scaleStep);break;case"weeks":var n=new Date(a.getTime());n=new Date(n.setDate(n.getDate()-21));var i=7*Math.floor(n.getDate()/7);a=new Date(n.getFullYear(),n.getMonth(),0===i?4:i-3);break;case"months":a.setHours(0,0,0,0),a.setDate(1),a.setMonth(a.getMonth()-3);break;case"days":default:a.setHours(0,0,0,0),a.setDate(a.getDate()-3)}return a},parseDateRange:function(e,t){var a=new Date(e.getTime()),n=[],l=0;do n[l++]=new Date(a.getTime()),a.setDate(a.getDate()+1);while(t>=a);return n},parseTimeRange:function(e,t,a){var n=new Date(e),l=new Date(t);n.setHours(0,0,0,0),l.setMilliseconds(0),l.setSeconds(0),(l.getMinutes()>0||l.getHours()>0)&&(l.setMinutes(0),l.setHours(0),l.setTime(l.getTime()+s));for(var o=[],r=0;;){var d=new Date(n);if(d.setHours(Math.floor(n.getHours()/a)*a),o[r]&&d.getDay()!==o[r].getDay()&&d.setHours(0),o[r]=d,n>t)break;n=i(d,a),r++}return o},parseWeeksRange:function(e,t){var a=e.getDayForWeek(),n=[],l=0;do n[l++]=a.getDayForWeek(),a.setDate(a.getDate()+7);while(t>=a);return n},parseMonthsRange:function(e,t){var a=new Date(e),n=(new Date(t),[]),l=0;do n[l++]=new Date(a.getFullYear(),a.getMonth(),1),a.setMonth(a.getMonth()+1);while(t>=a);return n},dateDeserialize:function(t){return"string"==typeof t&&(t=t.replace(/\/Date\((.*)\)\//,"$1"),t=e.isNumeric(t)?parseInt(t,10):e.trim(t)),new Date(t)},genId:function(t){switch(e.isNumeric(t)&&(t=new Date(t)),l.scale){case"hours":var a=t.getHours();return arguments.length>=2&&(a=Math.floor(t.getHours()/arguments[1])*arguments[1]),new Date(t.getFullYear(),t.getMonth(),t.getDate(),a).getTime();case"weeks":var n=t.getFullYear(),i=t.getWeekOfYear(),s=t.getMonth();return 11===s&&1===i?n++:!s&&i>51&&n--,n+"-"+i;case"months":return t.getFullYear()+"-"+t.getMonth();case"days":default:return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()}},_datesToDays:function(e){for(var t,a={},n=0,l=e.length;l>n;n++)t=r.dateDeserialize(e[n]),a[t.setHours(0,0,0,0)]=!0;return a},isHoliday:function(){if(!l.holidays||!l.holidays.length)return function(){return!1};var t=!1;return function(a){return t||(t=r._datesToDays(l.holidays)),!!t[e.isNumeric(a)?a:new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()]}}(),getCellSize:function(){if("undefined"==typeof r._getCellSize){var t=e('<div style="display: none; position: absolute;" class="fn-gantt"><div class="row"></div></div>');e("body").append(t),r._getCellSize=t.find(".row").height(),t.empty().remove()}return r._getCellSize},getPageHeight:function(e){return e.pageNum+1===e.pageCount?e.rowsOnLastPage*r.getCellSize():l.itemsPerPage*r.getCellSize()},getProgressBarMargin:function(){if("undefined"==typeof r._getProgressBarMargin){var t=e('<div style="display: none; position: absolute;"><div class="fn-gantt"><div class="rightPanel"><div class="dataPanel"><div class="row day"><div class="bar"></div></div></div></div></div></div>'),a=t.find(".fn-gantt .rightPanel .day .bar");e("body").append(t),r._getProgressBarMargin=parseInt(a.css("margin-left").replace("px",""),10),r._getProgressBarMargin+=parseInt(a.css("margin-right").replace("px",""),10),t.empty().remove()}return r._getProgressBarMargin}};this.each(function(){if(this.data=null,this.pageNum=0,this.pageCount=0,this.rowsOnLastPage=0,this.rowsNum=0,this.hPosition=0,this.dateStart=null,this.dateEnd=null,this.scrollClicked=!1,this.scaleOldWidth=null,this.headerRows=null,l.useCookie){var t=e.cookie(l.cookieKey+"CurrentScale");t?l.scale=t:e.cookie(l.cookieKey+"CurrentScale",l.scale)}switch(l.scale){case"hours":this.headerRows=5,this.scaleStep=1;break;case"weeks":this.headerRows=3,this.scaleStep=13;break;case"months":this.headerRows=2,this.scaleStep=14;break;case"days":default:this.headerRows=4,this.scaleStep=13}this.scrollNavigation={panelMouseDown:!1,scrollerMouseDown:!1,mouseX:null,panelMargin:0,repositionDelay:0,panelMaxPos:0,canScroll:!0},this.gantt=null,this.loader=null,o.create(this)})}}(jQuery);
